<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cajuia</title>

    <script src="https://cdn.jsdelivr.net/npm/tsparticles@3/tsparticles.bundle.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

    <style>
        :root { 
            --bg-color: #FFFFFF;
            --secondary-bg-color: #F8F8F8;
            --primary-color: #7A4E2D;
            --text-color-primary: #222222;
            --text-color-secondary: #888888;
            --border-color: #F0F0F0;
            --danger-color: #d33a2c;
            --font-family-sans: 'Poppins', sans-serif;
            --font-family-serif: 'Playfair Display', serif;
            --header-height: 60px;
            --footer-height: 70px;
            --white-color: #FFFFFF;
            --chat-bg-color: #EAE6DF; /* Cor de fundo que combina com o wallpaper */
            --chat-bubble-sent-bg: #7A4E2D; /* Seu marrom prim√°rio */
            --chat-bubble-received-bg: #FFFFFF;
            --chat-reply-border-color: #83C57A;
            --chat-info-text-color: #667781;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 16px; scroll-behavior: smooth; }
        
        body {
            font-family: var(--font-family-sans);
            background-color: var(--secondary-bg-color);
            color: var(--text-color-primary);
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
        }
        
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease-in-out; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .slide-up-enter-active, .slide-up-leave-active { transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .slide-up-enter-from, .slide-up-leave-to { transform: translateY(100%); }
        @keyframes fill-bar { from { width: 0%; } to { width: 100%; } }

        .splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #F7F3ED; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 2000; }
        .splash-screen .logo { width: 160px; margin-bottom: 25px; }
        .loading-bar-container { width: 180px; height: 6px; background-color: #EFEAE2; border-radius: 3px; overflow: hidden; }
        .loading-bar { height: 100%; width: 0%; background-color: var(--primary-color); border-radius: 3px; animation: fill-bar 6s ease-out forwards; }
        
        #app { padding-bottom: var(--footer-height); overflow-x: hidden; }
        .page {
            padding: 1rem;
            min-height: calc(100vh - var(--footer-height));
            overflow-x: hidden;
        }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding: 0 0.5rem; }
        .section-header h2 { font-size: 1.5rem; font-weight: 600; font-family: var(--font-family-sans); }
        .section-header .see-all { font-size: 0.9rem; font-weight: 500; color: var(--primary-color); text-decoration: none; }
        
        .home-page { padding: 0; padding-top: 0; background-color: #F7F3ED; }
        .home-header { position: absolute; top: 0; left: 0; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 0 1rem; height: var(--header-height); z-index: 1000; }
        .header-icon { background: rgba(255,255,255,0.7); backdrop-filter: blur(5px); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; color: var(--text-color-primary); }
        .header-icon svg { width: 24px; height: 24px; }
        
        .hero-carousel-container { position: relative; width: calc(100% - 30px);; height: 60vh; overflow: hidden; border-radius: 20px; margin: 15px; }
        .hero-carousel-wrapper { display: flex; height: 100%; transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1); }
        .hero-banner-slide { flex: 0 0 100%; position: relative; background-size: cover; background-position: center 30%; color: var(--white-color); display: flex; flex-direction: column; justify-content: flex-end; padding: 2rem 1.5rem; }
        .hero-banner-slide::before { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.4), transparent 50%); z-index: 1; }
        .hero-banner-slide > div { position: relative; z-index: 2; }
        .hero-banner-slide h1 { font-family: var(--font-family-serif); font-size: 2.5rem; font-weight: 700; line-height: 1.2; text-shadow: 1px 1px 3px rgba(0,0,0,0.4); }
        .hero-banner-slide p { font-size: 1rem; font-weight: 500; margin-top: 0.5rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
        .hero-banner-slide span { font-size: 3.5rem; font-weight: 700; font-family: var(--font-family-serif); text-shadow: 1px 1px 3px rgba(0,0,0,0.4); }
        .carousel-dots { position: absolute; bottom: 1rem; left: 50%; transform: translateX(-50%); display: flex; gap: 0.5rem; z-index: 3; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background-color: rgba(255,255,255,0.5); cursor: pointer; transition: background-color 0.3s, transform 0.3s; }
        .dot.active { background-color: var(--white-color); transform: scale(1.2); }
        .home-content { padding: 1.5rem 1rem; background-color: #F7F3ED; }
        .categories-carousel {
    overflow-x: auto;
    padding-bottom: 0.5rem;
    margin-left: -1rem;
    margin-right: -1rem;
}
.categories-list-horizontal {
    display: flex;
    gap: 1rem;
    padding: 0 1rem;
}
.categories-list-horizontal .category-item {
    min-width: 120px;
    max-width: 140px;
    flex: 0 0 auto;
}
        .category-item { position: relative; cursor: pointer; border-radius: 12px; overflow: hidden; aspect-ratio: 4 / 5; transition: transform 0.3s ease; }
        .category-item:active { transform: scale(0.97); }
        .category-icon { width: 100%; height: 100%; }
        .category-icon img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease; }
        .category-item:hover .category-icon img { transform: scale(1.05); }
        .category-item::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to top, rgba(0,0,0,0.6), transparent 60%); }
        .category-item span { position: absolute; bottom: 1rem; left: 1rem; right: 1rem; color: var(--white-color); font-size: 1.1rem; font-weight: 600; z-index: 2; }
        .product-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .product-card { background-color: transparent; border-radius: 12px; cursor: pointer; position: relative; }
        .product-card-image-wrapper { width: 100%; padding-top: 135%; position: relative; border-radius: 12px; overflow: hidden; background-color: #f0f0f0; }
        .product-card-image-wrapper img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .product-info { padding: 0.8rem 0.1rem; text-align: left; }
        .product-info h3 { font-size: 1rem; font-weight: 500; margin-bottom: 0.25rem; color: var(--text-color-primary); }
        .product-info p { font-size: 1rem; font-weight: 600; color: var(--text-color-primary); }
        .product-card .wishlist-icon {  position: absolute;  top: 10px; right: 10px;  z-index: 5;  width: 36px; height: 36px;  background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--footer-height); background-color: rgba(255, 255, 255, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid var(--border-color); z-index: 500; }
        .nav-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; color: var(--text-color-secondary); transition: color 0.3s, transform 0.2s ease; padding: 5px; }
        .nav-item:active { transform: scale(0.95); }
        .nav-item svg { width: 28px; height: 28px; }
        .nav-item span { font-size: 0.7rem; font-weight: 500; margin-top: 2px; }
        .nav-item.active { color: var(--primary-color); }
        .cart-badge { position: absolute; top: -2px; right: -5px; background-color: var(--primary-color); color: white; border-radius: 50%; width: 16px; height: 16px; font-size: 9px; display: flex; justify-content: center; align-items: center; font-weight: 600; border: 1px solid var(--white-color); }

        .product-detail-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--white-color); z-index: 1500; overflow-y: auto; }
        .detail-header { position: absolute; top: 1rem; left: 1rem; z-index: 210; }
        .back-button { background-color: rgba(255, 255, 255, 0.6); backdrop-filter: blur(5px); border: none; width: 44px; height: 44px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .product-detail-image { width: 100%; height: 60vh; object-fit: cover; cursor: pointer; }
        .product-detail-content { padding: 1.5rem; margin-top: -2rem; background: var(--white-color); border-radius: 16px 16px 0 0; position: relative; z-index: 10;}
        .detail-title-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem; position: relative; }
        .detail-title-row h1 { font-size: 1.5rem; font-weight: 600; flex-grow: 1; margin-right: 2.5rem; }
        .detail-title-row .wishlist-icon { position: absolute; top: -2.5rem; right: 0rem; width: 48px; height: 48px; background: var(--white-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 220; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .product-price-highlight { color: var(--primary-color); font-size: 1.5rem; font-weight: 700; margin: 0.3rem 0 1rem 0; display: block; }
        .product-detail-content .description { line-height: 1.7; margin: 1rem 0; color: var(--text-color-secondary); font-size: 0.95rem; }
        .variation-group { margin-bottom: 1.5rem; }
        .variation-group h3 { font-size: 1rem; font-weight: 600; margin-bottom: 1rem; }
        .options-container { display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center; }
        .size-button { padding: 0.6rem 1rem; border: 1.5px solid var(--border-color); border-radius: 8px; cursor: pointer; background-color: var(--white-color); color: var(--text-color-primary); font-weight: 600; transition: all 0.2s ease; }
        .size-button.active { border-color: var(--primary-color); background-color: var(--primary-color); color: var(--white-color); }
        .color-button { width: 36px; height: 36px; border: 2px solid var(--border-color); border-radius: 50%; cursor: pointer; transition: all 0.2s ease; }
        .color-button.active { border-color: var(--primary-color); transform: scale(1.15); box-shadow: 0 0 0 2px var(--primary-color) inset; }
        .add-to-cart-wrapper { padding: 1rem 1.5rem 1.5rem; background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); position: sticky; bottom: 0; left: 0; width: 100%; border-top: 1px solid var(--border-color); display: flex; align-items: center; gap: 1rem; }
        .quantity-selector { display: flex; align-items: center; gap: 1rem; }
        .quantity-selector button { width: 44px; height: 44px; border-radius: 50%; border: 1px solid var(--border-color); background-color: var(--white-color); font-size: 1.5rem; font-weight: 400; cursor: pointer; color: var(--text-color-primary); }
        .quantity-selector span { font-size: 1.2rem; font-weight: 600; min-width: 20px; text-align: center;}
        .add-to-cart-button { flex-grow: 1; padding: 1rem; border: none; background-color: var(--primary-color); color: var(--white-color); border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.3s; }
        .add-to-cart-button:disabled { background-color: #cccccc; cursor: not-allowed; }

        .zoom-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); z-index: 1600; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .zoom-modal img { max-width: 95%; max-height: 80%; object-fit: contain; }

        .cart-page { background-color: #F7F3ED; }
        .cart-page-header { display: flex; align-items: center; padding: 1rem 1rem 1rem 1rem; }
        .cart-page-header .back-button { background: none; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; margin-right: 1rem; }
        .cart-page-header h2 { font-size: 1.5rem; font-weight: 600; }
        .cart-list-container { position: relative; overflow: hidden; padding: 0 1rem; }
        .cart-item-wrapper { position: relative; margin-bottom: 1rem; background-color: var(--white-color); border-radius: 12px; overflow:hidden; }
        .delete-action { position: absolute; top: 0; right: 0; bottom: 0; width: 90px; background-color: #e74c3c; color: white; display: flex; justify-content: center; align-items: center; transform: translateX(100%); transition: transform 0.3s ease; }
        .delete-action svg { width: 28px; height: 28px; }
        .cart-item-wrapper.swiped .delete-action { transform: translateX(0); }
        .cart-item-content { display: flex; align-items: center; padding: 1rem; background-color: var(--white-color); transition: transform 0.3s ease; }
        .cart-item-checkbox { display: flex; align-items: center; justify-content: center; width: 24px; height: 24px; border: 2px solid var(--border-color); border-radius: 6px; margin-right: 1rem; cursor: pointer; flex-shrink: 0; }
        .cart-item-checkbox.checked { background-color: var(--primary-color); border-color: var(--primary-color); }
        .cart-item-checkbox.checked svg { display: block; }
        .cart-item-checkbox svg { color: white; width: 16px; height: 16px; display: none; }
        .cart-item-image { width: 80px; height: 100px; border-radius: 8px; object-fit: cover; margin-right: 1rem; background-color: #f0f0f0; }
        .cart-item-details { flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; gap: 0.5rem; }
        .cart-item-details h3 { font-size: 1rem; font-weight: 500; }
        .cart-item-details p { font-size: 0.9rem; color: var(--text-color-secondary); }
        .cart-item-price { font-size: 1rem; font-weight: 600; }
        .cart-item-controls { display: flex; align-items: center; justify-content: flex-end; }
        .cart-item-quantity-selector { display: flex; align-items: center; gap: 0.75rem; border: 1px solid var(--border-color); border-radius: 20px; padding: 4px; }
        .cart-item-quantity-selector button { width: 28px; height: 28px; border-radius: 50%; border: none; background-color: var(--secondary-bg-color); font-size: 1.2rem; cursor: pointer; color: var(--text-color-primary); display: flex; align-items: center; justify-content: center; }
        .cart-item-quantity-selector span { font-weight: 600; }
        .cart-summary { padding: 1.5rem 1rem; border-top: 1px solid var(--border-color); background: var(--white-color); }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 1rem; font-size: 1rem; }
        .summary-row.total { font-weight: 700; font-size: 1.2rem; }
        .checkout-button { width: 100%; padding: 1rem; margin-top: 1rem; border: none; background-color: var(--primary-color); color: var(--white-color); border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; }
        .empty-cart { text-align: center; color: var(--text-color-secondary); margin-top: 3rem; padding: 2rem; }

        .related-products-section { padding: 2rem 0 1rem 1rem; }
        .related-products-carousel { display: flex; overflow-x: auto; gap: 1rem; padding-bottom: 1rem; scrollbar-width: none; -ms-overflow-style: none; scroll-snap-type: x mandatory; }
        .related-products-carousel::-webkit-scrollbar { display: none; }
        .related-product-card { flex: 0 0 160px; scroll-snap-align: start; background-color: var(--white-color); border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .related-product-card img { width: 100%; height: 200px; object-fit: cover; }
        .related-product-info { padding: 0.75rem; }
        .related-product-info h3 { font-size: 0.9rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .related-product-info p { font-size: 0.85rem; color: var(--text-color-secondary); margin-top: 0.25rem; }

        .wishlist-icon svg { width: 24px; height: 24px; transition: fill 0.3s, transform 0.3s, stroke 0.3s; stroke: var(--text-color-primary); stroke-width: 1.5px; fill: transparent; }
        .wishlist-icon.active svg { fill: #e74c3c; stroke: #e74c3c; transform: scale(1.1); }
        .wishlist-page { padding: 1rem; min-height: calc(100vh - var(--footer-height)); background-color: #F7F3ED; }
        .wishlist-empty { text-align: center; color: var(--text-color-secondary); margin-top: 3rem; }
        .wishlist-list { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        
[v-cloak] {
  display: none;
}
        .empty-results-textured {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding-top: 4rem;
    user-select: none; /* Impede que o texto seja selecionado */
}
.empty-results-textured span {
    font-size: 5rem;
    font-weight: 600;
    color: var(--border-color);
    text-shadow: 1px 1px 3px rgba(0,0,0,0.05);

    /* --- ADICIONE ESTAS 3 LINHAS --- */
    transform: rotate(-90deg); /* Gira o emoticon 90 graus para a esquerda */
    display: inline-block;     /* Garante que a transforma√ß√£o seja aplicada corretamente */
    margin-bottom: 1rem;       /* Adiciona um pequeno espa√ßo abaixo do emoticon girado */
}
.empty-results-textured p {
    font-size: 1.2rem;
    font-weight: 500;
    line-height: 1.4;
    color: #cccccc; /* Cor ainda mais suave */
    text-shadow: 1px 1px 3px rgba(0,0,0,0.05);
    margin-top: 1rem;
}
        .close-overlay-btn {
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--text-color-primary);
    line-height: 0; /* Alinha o √≠cone perfeitamente */
}
        
.filters-container-overlay {
    padding-bottom: 1rem;
    margin-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
}
/* Reutilizando os estilos que j√° t√≠nhamos para os filtros */
.filter-group {
    background-color: transparent;
    padding: 0.5rem 0;
    margin-bottom: 1rem;
    box-shadow: none;
}
.filter-group h3 {
    font-size: 1rem;
    margin-bottom: 0.75rem;
}
        
        /* --- Estilos para o Novo Cabe√ßalho --- */
.home-top-bar {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem 1rem;
    background-color: #F7F3ED; /* Mesma cor de fundo da home */
    position: sticky;
    top: 0;
    z-index: 400;
}
.top-search-bar {
    flex-grow: 1;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background-color: var(--white-color);
    padding: 0.75rem 1rem;
    border-radius: 2rem;
    color: var(--text-color-secondary);
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
.top-search-bar span {
    font-weight: 500;
}

/* --- Estilos para o Overlay de Pesquisa --- */
.search-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--secondary-bg-color);
    z-index: 1200;
    display: flex;
    flex-direction: column;
}
.search-overlay-header {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    gap: 1rem;
    background-color: var(--white-color);
    border-bottom: 1px solid var(--border-color);
}
.search-input-overlay {
    flex-grow: 1;
    border: none;
    background: none;
    font-size: 1rem;
    padding: 0.5rem;
}
.search-input-overlay:focus {
    outline: none;
}
.close-overlay-btn {
    background: none;
    border: none;
    color: var(--primary-color);
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
}
.search-overlay-content {
    flex-grow: 1;
    overflow-y: auto;
    padding: 1rem;
}
.search-placeholder {
    text-align: center;
    color: var(--text-color-secondary);
    margin-top: 4rem;
}

/* --- Estilos para a Tela de Chat (Placeholder) --- */
.chat-page {
    display: flex;
    flex-direction: column;
    height: calc(100vh - var(--footer-height));
    padding: 0;
}
.chat-container {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    padding: 1rem;
}
.chat-messages {
    flex-grow: 1;
    overflow-y: auto;
}
.message {
    padding: 0.75rem 1rem;
    border-radius: 1rem;
    margin-bottom: 0.75rem;
    max-width: 80%;
}
.message.received {
    background-color: var(--border-color);
    border-bottom-left-radius: 0.25rem;
    align-self: flex-start;
}
.chat-input-area {
    display: flex;
    gap: 0.5rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
}
.chat-input-area input {
    flex-grow: 1;
    border: 1px solid var(--border-color);
    border-radius: 2rem;
    padding: 0.75rem 1rem;
    font-size: 1rem;
}
.chat-input-area button {
    border: none;
    background-color: var(--primary-color);
    color: white;
    padding: 0 1.5rem;
    border-radius: 2rem;
    font-weight: 600;
    cursor: pointer;
}
        
        /* --- P√°gina de Perfil (Layout Refatorado) --- */
        .profile-page { padding: 0; background-color: var(--secondary-bg-color); }
        
        .page-header {
            display: flex;
            align-items: center;
            padding: 1rem;
            background-color: var(--white-color);
            border-bottom: 1px solid var(--border-color);
        }
        .page-header h2 {
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
            flex-grow: 1;
        }
        .page-header .back-button-profile {
            background: none;
            border: none;
            cursor: pointer;
        }

        .profile-header-card {
            background-color: var(--primary-color);
            margin: 0;
            padding: 2.5rem 1rem 2rem 1rem;
            text-align: center;
            color: var(--white-color);
        }
        .profile-picture-wrapper {
            position: relative;
            display: inline-block;
            margin-bottom: 1rem;
        }
        .profile-picture {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--white-color);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .upload-button {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 32px;
            height: 32px;
            background-color: var(--white-color);
            color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .upload-button svg { width: 18px; height: 18px; }
        .profile-name { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.25rem; }
        .profile-email {
            font-size: 1rem;
            color: var(--white-color);
            opacity: 0.8;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 90%;
            margin: 0 auto;
            display: block;
        }

        .profile-menu-list { padding: 1.5rem 1rem; }
        .profile-menu-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background-color: var(--white-color);
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .profile-menu-item:active { transform: scale(0.98); }
        .menu-item-icon { color: var(--primary-color); }
        .menu-item-icon svg { width: 24px; height: 24px; }
        .menu-item-label { flex-grow: 1; font-weight: 600; }
        .menu-item-chevron { color: var(--text-color-secondary); }
        .menu-item-icon.logout { color: var(--danger-color); }
        
        .profile-form {
            background-color: var(--secondary-bg-color);
            padding: 1.5rem 1rem;
        }
        .form-group { margin-bottom: 1.25rem; }
        .form-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-color-primary);
        }
        .form-group input {
            width: 100%;
            padding: 0.9rem;
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            font-family: var(--font-family-sans);
            transition: border-color 0.3s;
            background-color: var(--white-color);
        }
        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(122, 78, 45, 0.2);
        }
        .save-button {
             width: 100%; 
             padding: 1rem; 
             margin-top: 1rem;
             border: none; 
             background-color: var(--primary-color); 
             color: var(--white-color);
             border-radius: 12px;
             font-size: 1rem;
             font-weight: 600;
             cursor: pointer;
        }
        .profile-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 1.5rem;
            border-radius: 10px;
            color: var(--white-color);
            background-color: #27ae60;
            z-index: 2500;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .profile-notification.error { background-color: #e74c3c; }

        /* --- [NOVO] Sauda√ß√£o na Home --- */
        .greeting-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.2rem;
            padding: 2rem 0.5rem;
            margin: 0px 20px 0px 20px;
        }
        .greeting-text h2 {
            font-size: 1.6rem;
            font-weight: 600;
        }
        .greeting-text p {
            font-size: 1rem;
            color: var(--text-color-secondary);
            font-weight: 500;
        }
        .greeting-profile-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--border-color);
            cursor: pointer;
        }
            .search-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
            flex-grow: 1;
        }
        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(122, 78, 45, 0.2);
        }
        .filters-container {
            padding: 0 1rem 1rem;
            background-color: var(--secondary-bg-color);
        }
        .filter-group {
            background-color: var(--white-color);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            overflow: hidden;
        }
        .filter-group h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-color-primary);
        }
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        .filter-button {
            padding: 0.6rem 1rem;
            border: 1.5px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--white-color);
            color: var(--text-color-primary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .filter-button.active {
            border-color: var(--primary-color);
            background-color: var(--primary-color);
            color: var(--white-color);
        }
        .filter-price-inputs {
            display: flex;
            gap: 0.5rem;
        }
        .filter-price-inputs input {
            flex-grow: 1;
            padding: 0.6rem 0.8rem;
            border: 1.5px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: var(--font-family-sans);
            background-color: var(--secondary-bg-color);
            max-width: 100px;
        }
        .filter-price-inputs input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        .search-results-grid {
            padding: 0 1rem 1rem;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .auth-page {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    .auth-logo {
        width: 500px;
        height: 150px;
        object-fit: contain;
        margin-bottom: 1.5rem;
        display: block;
    }
.collections-list {
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
    padding: 1rem 0.5rem;
}
.collection-card {
    display: flex;
    align-items: center;
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    padding: 0.7rem 1rem;
    cursor: pointer;
    gap: 1rem;
    transition: box-shadow 0.2s, transform 0.2s;
}
.collection-card:active {
    transform: scale(0.98);
}
.collection-image {
    width: 70px;
    height: 70px;
    border-radius: 12px;
    object-fit: cover;
    background: #f0f0f0;
}
.collection-info h3 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.2rem;
}
.collection-info p {
    font-size: 0.95rem;
    color: #888;
}

.collections-list-vertical {
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
    padding: 1rem 0.5rem;
}
.collection-card-vertical {
    position: relative;
    height: 110px;
    border-radius: 16px;
    overflow: hidden;
    cursor: pointer;
    background-size: cover;
    background-position: center;
    display: flex;
    align-items: flex-end;
    margin-bottom: 0.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    transition: transform 0.15s;
}
.collection-card-vertical:active {
    transform: scale(0.98);
}
.collection-card-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(0deg, rgba(0,0,0,0.45) 70%, rgba(0,0,0,0.05) 100%);
    z-index: 1;
}
.collection-card-content {
    position: relative;
    z-index: 2;
    color: #fff;
    padding: 1.2rem 1.2rem 1.2rem 1.2rem;
    width: 100%;
}
.collection-card-content h3 {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 0.2rem;
    text-shadow: 0 2px 8px rgba(0,0,0,0.18);
}
.collection-card-content p {
    font-size: 1rem;
    font-weight: 500;
    opacity: 0.95;
    text-shadow: 0 2px 8px rgba(0,0,0,0.18);
}

.active-thumb {
  border-color: var(--primary-color) !important;
}
        /* --- Fundo Din√¢mico (V√≠deo e Part√≠culas) --- */
#background-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1; /* Fica atr√°s de todo o conte√∫do */
}
#bg-video {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Cobre toda a tela sem distorcer */
}
#particles-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

/* Garante que o app fique na frente do fundo */
#app {
    position: relative;
    z-index: 2;
}

/* --- Novo Estilo de Card "Glassmorphism" --- */
.glass-card {
    background: rgba(255, 255, 255, 0.1); /* Cor de fundo semi-transparente */
    backdrop-filter: blur(25px); /* O efeito de vidro emba√ßado */
    -webkit-backdrop-filter: blur(25px);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
    padding: 2.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* --- Ajustes nas Telas de Carregamento e Auth --- */
.splash-screen, .auth-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2000;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem;
    /* Remove a cor de fundo antiga para que o v√≠deo apare√ßa */
    background: none; 
}
.auth-card {
    width: 100%;
    max-width: 420px;
    color: var(--text-color-primary);
}
.auth-card .auth-logo {
    width: 150px;
    height: auto;
    margin-bottom: 1rem;
    filter: drop-shadow(0px 0px 10px rgba(255, 255, 255, 0.7));
}

/* --- Anima√ß√£o "Respira√ß√£o" para a Logo do Loading --- */
.loading-logo {
    width: 160px;
    margin-bottom: 25px;
    animation: breathing 3s ease-in-out infinite;
}

@keyframes breathing {
    0%   { transform: scale(0.95); opacity: 0.8; }
    50%  { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(0.95); opacity: 0.8; }
}

        /* T√≠tulo (Entrar, Cadastro) */
.auth-card h2 {
    color: var(--white-color);
    text-shadow: 1px 1px 3px rgba(0,0,0,0.2); /* Sombra para melhor legibilidade */
}

/* Labels dos campos (E-mail, Senha, etc.) */
.auth-card .form-group label {
    color: rgba(255, 255, 255, 0.9);
}

/* Par√°grafo ("N√£o tem conta?") */
.auth-card p {
    color: rgba(255, 255, 255, 0.8);
}

/* Link ("Cadastre-se") */
.auth-card p a {
    color: var(--white-color);
    font-weight: 600;
    text-decoration: underline;
}

/* Deixa os campos de input com efeito de vidro tamb√©m */
.auth-card input {
    background-color: rgba(255, 255, 255, 0.2) !important;
    color: var(--white-color) !important;
    border-color: rgba(255, 255, 255, 0.3) !important;
}

/* Cor do texto de placeholder (Ex: "Digite seu e-mail") */
.auth-card input::placeholder {
    color: rgba(255, 255, 255, 0.7);
}

/* --- TELA DE LOADING --- */

/* Garante que qualquer texto dentro do card de loading seja branco */
.splash-screen .glass-card {
    color: var(--white-color);
}

        /* --- ESTILOS DO CHAT (NOVOS E ATUALIZADOS) --- */
.chat-page {
    display: flex;
    flex-direction: column;
    height: calc(100vh - var(--footer-height));
    padding: 0;
    background-color: var(--chat-bg-color);
    background-image: url('https://cdn.shopify.com/s/files/1/0927/1286/1998/files/Design_sem_nome_13.jpg?v=1752694469');
    background-blend-mode: multiply;
    background-size: 200%;
}
.chat-header {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    background-color: var(--white-color);
    border-bottom: 1px solid var(--border-color);
    gap: 1rem;
    flex-shrink: 0;
}
.chat-header img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}
.chat-header-info h3 { font-size: 1.1rem; font-weight: 600; }
.chat-header-info p { font-size: 0.8rem; color: var(--text-color-secondary); }

.chat-messages-container {
    flex-grow: 1;
    overflow-y: auto;
    padding: 1rem;
    display: flex;
    flex-direction: column;
}

.message-bubble {
    display: flex;
    flex-direction: column;
    max-width: 80%;
    margin-bottom: 0.75rem;
    position: relative;
}
.message-bubble.sent {
    align-self: flex-end;
    background-color: var(--primary-color); /* Marrom */
    color: var(--white-color); /* Texto branco */
    border-radius: 12px 12px 0 12px;
}
.message-bubble.received {
    align-self: flex-start;
    background-color: var(--chat-bubble-received-bg); /* Branco/Creme */
    color: var(--text-color-primary); /* Texto preto */
    border-radius: 12px 12px 12px 0;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

        .message-bubble.sent .message-meta {
    color: rgba(255, 255, 255, 0.7);
}
.message-bubble.sent .message-meta .read-receipts svg {
    color: #53bdeb; /* Mant√©m o azul para o "lido" */
}

.message-content-wrapper {
    padding: 0.6rem 0.8rem;
}

.reply-context {
    padding: 0.5rem 0.8rem;
    margin: 0.2rem 0.2rem 0 0.2rem;
    background-color: rgba(0,0,0,0.05);
    border-left: 3px solid var(--chat-reply-border-color);
    border-radius: 6px;
    font-size: 0.9rem;
    cursor: pointer;
}
.reply-context p {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px;
    font-size: 0.85rem;
    color: var(--text-color-secondary);
}
.reply-context strong {
    color: var(--primary-color);
    font-weight: 600;
}

.message-content {
    font-size: 1rem;
    line-height: 1.4;
    white-space: pre-wrap; /* Mant√©m quebras de linha */
    word-wrap: break-word;
}

.message-image-attachment {
    width: 100%;
    max-width: 250px;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 0.5rem;
}
.message-file-attachment {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background-color: rgba(0,0,0,0.05);
    padding: 0.75rem;
    border-radius: 8px;
    margin-top: 0.5rem;
}
.file-icon {
    width: 40px;
    height: 40px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--primary-color);
    color: white;
    border-radius: 8px;
}
.file-info p {
    font-weight: 600;
    font-size: 0.9rem;
}
.file-info span {
    font-size: 0.8rem;
    color: var(--text-color-secondary);
}

.message-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
    color: var(--chat-info-text-color);
    align-self: flex-end;
    margin: -0.2rem 0.5rem 0.2rem 0;
}
.message-meta .edited-indicator { font-style: italic; }
.message-meta .read-receipts svg { width: 16px; height: 16px; color: #53bdeb; }

.chat-input-area {
    display: flex;
    align-items: flex-end; /* Alinha itens na base */
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background-color: var(--white-color);
    border-top: 1px solid var(--border-color);
    flex-shrink: 0;
}
.chat-input-area textarea {
    flex-grow: 1;
    border: 1.5px solid var(--border-color);
    border-radius: 22px;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    font-family: var(--font-family-sans);
    resize: none;
    max-height: 100px;
    line-height: 1.4;
}
.chat-input-area textarea:focus {
    outline: none;
    border-color: var(--primary-color);
}
.chat-input-area .icon-button {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background-color: var(--primary-color);
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.reply-preview-bar {
    padding: 0.5rem 1rem;
    background-color: #f0f0f0;
    border-bottom: 1px solid #ddd;
}
.reply-preview-bar strong { color: var(--primary-color); }
.reply-preview-bar p {
    font-size: 0.9em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

  .chat-input-area .icon-button svg,
.chat-input-area .icon-button svg path {
    fill: var(--white-color) !important;
}
    </style>
</head>
    
<body>
    
<div id="app" v-cloak>
    <div v-if="showVideoBackground" id="background-container">
        <video autoplay muted loop playsinline id="bg-video" poster="https://cdn.shopify.com/s/files/1/0927/1286/1998/files/Sem_titulo.jpg?v=1752751633">
            <source src="https://cdn.shopify.com/videos/c/o/v/efca50839f7642a49b9479497519db32.mp4" type="video/mp4">
        </video>
        <div id="particles-container"></div>
    </div>

    <transition name="fade">
    <div v-if="isLoading" class="splash-screen">
        <div class="glass-card">
            <img src="https://cdn.shopify.com/s/files/1/0927/1286/1998/files/Design_sem_nome_-_2025-06-13T102227.591.png?v=1750256134" alt="Logo da Loja" class="loading-logo">
            <div class="loading-bar-container"><div class="loading-bar"></div></div>
        </div>
    </div>
</transition>

 <transition name="fade">
    <div v-if="authView === 'login'" class="auth-container">
        <div class="glass-card auth-card">
            <img src="https://cdn.shopify.com/s/files/1/0927/1286/1998/files/Sem_nome__200_x_200_px___1_-removebg-preview.png?v=1750269476" alt="Logo" class="auth-logo">
            <h2 style="margin-bottom: 2rem;">Entrar</h2>
            <form @submit.prevent="login">
                <div class="form-group">
                    <label for="login-email">E-mail</label>
                    <input id="login-email" v-model="loginForm.email" type="email" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="login-password">Senha</label>
                    <input id="login-password" v-model="loginForm.password" type="password" required autocomplete="current-password">
                </div>
                <button class="save-button" type="submit" :disabled="authLoading">Entrar</button>
            </form>
            <p style="margin-top:1.5rem;">N√£o tem conta? <a href="#" @click.prevent="authView = 'register'" style="color: var(--primary-color); font-weight: 600;">Cadastre-se</a></p>
            <div v-if="authError" style="color:#d33a2c; font-weight: 500; margin-top:1rem;">{{ authError }}</div>
        </div>
    </div>

    <div v-else-if="authView === 'register'" class="auth-container">
        <div class="glass-card auth-card">
            <img src="https://cdn.shopify.com/s/files/1/0927/1286/1998/files/Sem_nome__200_x_200_px___1_-removebg-preview.png?v=1750269476" alt="Logo" class="auth-logo">
            <h2 style="margin-bottom: 2rem;">Cadastro</h2>
            <form @submit.prevent="register">
                <div class="form-group">
                    <label for="register-name">Nome Completo</label>
                    <input id="register-name" v-model="registerForm.nome" type="text" required>
                </div>
                <div class="form-group">
                    <label for="register-email">E-mail</label>
                    <input id="register-email" v-model="registerForm.email" type="email" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="register-password">Senha</label>
                    <input id="register-password" v-model="registerForm.password" type="password" required autocomplete="new-password">
                </div>
                <button class="save-button" type="submit" :disabled="authLoading">Cadastrar</button>
            </form>
            <p style="margin-top:1.5rem;">J√° tem conta? <a href="#" @click.prevent="authView = 'login'" style="color: var(--primary-color); font-weight: 600;">Entrar</a></p>
            <div v-if="authError" style="color:#d33a2c; font-weight: 500; margin-top:1rem;">{{ authError }}</div>
        </div>
    </div>
</transition>

    <main v-if="!isLoading && !errorOnLoad && authView === null">
        
        <transition name="fade">
            <div v-if="profileNotification.show" class="profile-notification" :class="profileNotification.type">
                {{ profileNotification.message }}
            </div>
        </transition>

        <transition name="fade" mode="out-in">
            <div v-if="currentView === 'home'" class="home-page">
               <!-- NOVO CABE√áALHO DA HOME -->
                    <header class="home-top-bar">
                        <div class="top-search-bar" @click="openSearchOverlay">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            <span>O que voc√™ procura?</span>
                        </div>
                        <div class="header-icon" @click="changeView('cart')" style="position: relative;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                            <span v-if="cartItemCount > 0" class="cart-badge">{{ cartItemCount }}</span>
                        </div>
                    </header>

                <div class="greeting-header">
    <div class="greeting-text">
        <h2>Ol√°, {{ userFirstName }} üëã</h2>
        <p>{{ timeBasedGreeting.text }} {{ timeBasedGreeting.emoji }}</p>
    </div>
    <img :src="userProfile.fotoUrl || 'https://i.pravatar.cc/150'" 
         alt="Foto do Perfil" 
         class="greeting-profile-pic" 
         @click="changeView('profile')">
</div>
                    
                <section v-if="personalizacao.heroAtivo && personalizacao.heroBanners && personalizacao.heroBanners.length > 0" class="hero-carousel-container">
                    <div class="hero-carousel-wrapper" :style="{ transform: 'translateX(' + (-currentSlide * 100) + '%)' }">
                        <div v-for="slide in personalizacao.heroBanners" :key="slide.id" class="hero-banner-slide" :style="{ backgroundImage: 'linear-gradient(to top, rgba(0,0,0,0.4), transparent 50%), url(' + slide.imagemFundo + ')' }">
                            <div>
                                <h1>{{ slide.titulo }}</h1>
                                <span v-if="slide.desconto">{{ slide.desconto }}</span>
                                <p v-if="slide.subtitulo">{{ slide.subtitulo }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-dots" v-if="personalizacao.heroBanners.length > 1">
                        <span v-for="(slide, index) in personalizacao.heroBanners" :key="'dot-'+slide.id" 
                              class="dot" :class="{ active: currentSlide === index }" @click="goToSlide(index)"></span>
                    </div>
                </section>
                
                <div class="home-content" :style="{ paddingTop: (personalizacao.heroAtivo && personalizacao.heroBanners && personalizacao.heroBanners.length > 0) ? '2rem' : '0' }">

                    <section style="margin-bottom: 2.5rem;">
                    <div class="section-header">
                        <h2>Cole√ß√µes</h2>
                        <a href="#" @click.prevent="changeView('collections')" class="see-all">Ver todas</a>
                    </div>
                    <div class="categories-carousel">
                        <div class="categories-list-horizontal">
                            <div v-for="category in categories" :key="category.id" class="category-item" @click="selectedCategoryId = category.id">
                                <div class="category-icon"><img :src="category.icone" :alt="category.nome" loading="lazy"></div>
                                <span>{{ category.nome }}</span>
                            </div>
                        </div>
                    </div>
                </section>
                    
                    <section>
                        <div class="section-header">
                            <h2>{{ selectedCategoryId ? getCategoryNameById(selectedCategoryId) : 'Destaques da Esta√ß√£o' }}</h2>
                             <a href="#" @click.prevent="selectedCategoryId = null" class="see-all" v-if="selectedCategoryId">Ver todos</a>
                        </div>
                        <div class="product-grid">
                            <div v-for="product in filteredProducts" :key="product.id" @click="showProductDetail(product)" class="product-card">
                                <div class="wishlist-icon" :class="{active: isInWishlist(product.id)}" @click.stop="toggleWishlist(product)">
                                    <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                                </div>
                                <div class="product-card-image-wrapper"><img :src="product.imagem" :alt="product.nome" loading="lazy"></div>
                                <div class="product-info">
                                    <h3>{{ product.nome }}</h3>
                                    <template v-if="product.precoPromocionalAtivo && product.mostrarPrecoPromocional && product.precoPromocional !== null">
  <span style="text-decoration:line-through; opacity:0.5; font-size:0.95em; margin-right:0.5em;">
    {{ formatCurrency(product.preco) }}
  </span>
  <span style="color:var(--primary-color); font-weight:700; font-size:1.1em;">
    {{ formatCurrency(product.precoPromocional) }}
  </span>
</template>
<template v-else>
  <p>{{ formatCurrency(product.preco) }}</p>
</template>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            
            <div v-else-if="currentView === 'cart'" class="page cart-page">
                 <div class="cart-page-header">
                     <button @click="changeView('home')" class="back-button">
                         <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"></path></svg>
                    </button>
                    <h2>Carrinho</h2>
                </div>
                <div v-if="cart.length > 0">
                    <div class="cart-list-container">
                        <div v-for="item in cart" :key="item.cartItemId" class="cart-item-wrapper" :class="{ swiped: swipeState[item.cartItemId] && swipeState[item.cartItemId].isSwiped }">
                            <div class="delete-action" @click="removeFromCart(item.cartItemId)">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"></path></svg>
                            </div>
                            <div class="cart-item-content" 
                                 :style="getSwipeStyle(item.cartItemId)"
                                 @touchstart="handleTouchStart(item.cartItemId, $event)"
                                 @touchmove="handleTouchMove(item.cartItemId, $event)"
                                 @touchend="handleTouchEnd(item.cartItemId)">
                                <div class="cart-item-checkbox" :class="{ checked: item.selected }" @click.stop="toggleCartItemSelection(item.cartItemId)">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                                </div>
                                <img :src="getProductById(item.product_id).imagem" class="cart-item-image" loading="lazy">
                                <div class="cart-item-details">
                                    <div>
                                        <h3>{{ getProductById(item.product_id).nome }}</h3>
                                        <p>{{ getProductById(item.product_id).tipo }}</p>
                                    </div>
                                    <span class="cart-item-price">{{ formatCurrency(getActiveProductPrice(getProductById(item.product_id))) }}</span>
                                </div>
                                <div class="cart-item-controls">
                                    <div class="cart-item-quantity-selector">
                                        <button @click.stop="updateCartQuantity(item.cartItemId, -1)">-</button>
                                        <span>{{ item.quantity }}</span>
                                        <button @click.stop="updateCartQuantity(item.cartItemId, 1)">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                     <section class="related-products-section" v-if="relatedProducts.length > 0">
                         <div class="section-header" style="padding-right: 1rem;">
                             <h2>Voc√™ tamb√©m pode gostar</h2>
                             <a href="#" @click.prevent="changeView('home')" class="see-all">Ver Todos</a>
                         </div>
                         <div class="related-products-carousel">
                              <div v-for="product in relatedProducts" :key="'related-'+product.id" class="related-product-card" @click="showProductDetail(product)">
                                 <img :src="product.imagem" :alt="product.nome" loading="lazy">
                                 <div class="related-product-info">
                                     <h3>{{ product.nome }}</h3>
                                     <p>{{ formatCurrency(product.preco) }}</p>
                                 </div>
                             </div>
                         </div>
                     </section>
                </div>
                <div v-else class="empty-cart">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="48" height="48" style="color: #ccc; margin-bottom: 1rem;"><path d="M17,18C15.89,18 15,18.89 15,20A2,2 0 0,0 17,22A2,2 0 0,0 19,20C19,18.89 18.1,18 17,18M7,18C5.89,18 5,18.89 5,20A2,2 0 0,0 7,22A2,2 0 0,0 9,20C9,18.89 8.1,18 7,18M7.17,14.75L7.2,14.63L8.1,13H15.55C16.3,13 16.96,12.58 17.3,11.97L20.88,5.5L19.25,4.5L16,9H8.53L8.4,8.73L6.16,4H4V6H6L9.6,13.59L8.25,16.24C8.09,16.53 8,16.88 8,17.25A2,2 0 0,0 10,19H18V17H10.42C10.29,17 10.17,16.89 10.1,16.75L10.17,16.63L7.17,14.75Z"></path></svg>
                    <p>Seu carrinho est√° vazio.</p>
                </div>
                <button class="checkout-button" style="background:#2d7a4e; margin-bottom: 1rem; display:flex;align-items:center;gap:8px;"
        @click="calcularFrete">
    <svg style="width:22px;height:22px;" fill="currentColor" viewBox="0 0 24 24"><path d="M18,18A2,2 0 0,0 20,20A2,2 0 0,0 22,18A2,2 0 0,0 20,16A2,2 0 0,0 18,18M6,18A2,2 0 0,0 8,20A2,2 0 0,0 10,18A2,2 0 0,0 8,16A2,2 0 0,0 6,18M18,8V6A2,2 0 0,0 16,4H5A2,2 0 0,0 3,6V16A2,2 0 0,0 5,18H6A4,4 0 0,1 14,18H16A4,4 0 0,1 20,14V10A2,2 0 0,0 18,8M16,6V8H5V6H16M20,10V14A2,2 0 0,1 18,16H14A2,2 0 0,1 12,14V10H20Z" /></svg>
    Transportadoras dispon√≠veis
</button>
                <div class="cart-summary" v-if="cart.length > 0">
                    <div class="summary-row"><span>Subtotal</span><span>{{ formatCurrency(cartTotalPrice) }}</span></div>
                    <div class="summary-row" style="font-size:0.95em;color:#888;">
                        <span>Frete:</span>
                        <span v-if="selectedShipping">
                            <img :src="selectedShipping.company.picture" :alt="selectedShipping.company.name" style="width:22px;vertical-align:middle;margin-right:4px;">
                            {{ selectedShipping.company.name }} ({{ selectedShipping.name }}) - 
                            <span style="color:#2d7a4e;font-weight:700;">{{ formatCurrency(valorFrete) }}</span>
                        </span>
                        <span v-else>Selecione uma transportadora</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total</span>
                        <span>{{ formatCurrency(cartTotalPrice + (valorFrete || 0)) }}</span>
                    </div>
                    <button @click="finalizePurchase" class="checkout-button" :disabled="!userProfile.cep || !valorFrete">Finalizar Compra</button>
                    <button @click="sendOrderToWhatsApp" class="checkout-button" style="background:#25D366; margin-top: 0.5rem;">
                        Finalizar pelo WhatsApp
                    </button>
                </div>
            </div>

  <div v-else-if="currentView === 'wishlist'" class="page wishlist-page">
                    <h2 style="margin: 1.5rem 0 1rem 0;">Favoritos</h2>
                    <div v-if="wishlistProducts.length > 0" class="wishlist-list">
                        <div v-for="product in wishlistProducts" :key="product.id" class="product-card">
                            <div class="wishlist-icon active" @click.stop="toggleWishlist(product)">
                                <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                            </div>
                            <div class="product-card-image-wrapper">
                                <img :src="product.imagem" :alt="product.nome" loading="lazy">
                            </div>
                            <div class="product-info">
                                <h3>{{ product.nome }}</h3>
                                <p>{{ formatCurrency(product.preco) }}</p>
                                <button class="save-button" style="margin-top: 0.5rem; padding: 0.5rem 1rem; font-size: 0.9rem;"
                                    @click.stop="addWishlistToCart(product)">
                                    Adicionar ao Carrinho
                                </button>
                            </div>
                        </div>
                    </div>
                    <div v-else class="wishlist-empty">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="48" height="48" style="color: #ccc; margin-bottom: 1rem;"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        <p>Voc√™ ainda n√£o adicionou nenhum favorito.</p>
                    </div>
                </div>

                <div v-else-if="currentView === 'collections'" class="page collections-page" style="background-color: #F7F3ED;">
    <div class="search-header" style="background-color: #F7F3ED;">
        <button @click="changeView('home')" class="back-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"></path></svg>
        </button>
        <h2>Cole√ß√µes</h2>
    </div>
    <div class="collections-list-vertical">
        <div v-for="category in categories" :key="category.id" class="collection-card-vertical" @click="selectedCategoryId = category.id; changeView('home')"
            :style="{ backgroundImage: 'url(' + category.icone + ')' }">
            <div class="collection-card-overlay"></div>
            <div class="collection-card-content">
                <h3>{{ category.nome }}</h3>
                <p>{{ category.produtosCount ? category.produtosCount + ' Produtos' : '' }}</p>
            </div>
        </div>
    </div>
</div>


            <div v-else-if="currentView === 'profile'" class="page profile-page">
                <div v-if="profileSubView === 'main'">
                    <div class="profile-header-card">
                        <div class="profile-picture-wrapper">
                            <img :src="userProfile.fotoUrl || 'https://cdn.shopify.com/s/files/1/0927/1286/1998/files/266033.png?v=1750354671'" alt="Foto do Perfil" class="profile-picture">
                            <div class="upload-button" @click="profileSubView = 'edit'">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path></svg>
                            </div>
                        </div>
                        <h2 class="profile-name">{{ userProfile.nome || 'Nome do Usu√°rio' }}</h2>
                        <p class="profile-email">{{ userProfile.email || 'email@exemplo.com' }}</p>
                    </div>

                    <div class="profile-menu-list">
                        <div class="profile-menu-item" @click="profileSubView = 'edit'">
                            <div class="menu-item-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
    <path d="M3 17.25V21h3.75l11-11.03-3.75-3.75L3 17.25zm14.71-9.04a1 1 0 0 0 0-1.41l-2.5-2.5a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.99-1.99z"/>
  </svg>
</div>
                            <span class="menu-item-label">Editar Perfil</span>
                            <div class="menu-item-chevron"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9.29 15.88L13.17 12 9.29 8.12a.996.996 0 111.41-1.41l4.59 4.59c.39.39.39 1.02 0 1.41L10.7 17.3a.996.996 0 01-1.41 0c-.38-.39-.39-1.03 0-1.42z"></path></svg></div>
                        </div>

                        <div class="profile-menu-item" @click="showWipAlert">
                            <div class="menu-item-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
    <path d="M12 17a2 2 0 0 0 2-2v-2a2 2 0 1 0-4 0v2a2 2 0 0 0 2 2zm6-6V7a6 6 0 1 0-12 0v4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2zm-8-4a4 4 0 1 1 8 0v4H6V7z"/>
  </svg>
</div>
                            <span class="menu-item-label">Alterar Senha</span>
                             <div class="menu-item-chevron"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9.29 15.88L13.17 12 9.29 8.12a.996.996 0 111.41-1.41l4.59 4.59c.39.39.39 1.02 0 1.41L10.7 17.3a.996.996 0 01-1.41 0c-.38-.39-.39-1.03 0-1.42z"></path></svg></div>
                        </div>

                        <div class="profile-menu-item" @click="showWipAlert">
                            <div class="menu-item-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
    <path d="M12 22a2 2 0 0 0 2-2h-4a2 2 0 0 0 2 2zm6-6V11c0-3.07-1.63-5.64-4.5-6.32V4a1.5 1.5 0 1 0-3 0v.68C7.63 5.36 6 7.92 6 11v5l-1.29 1.29A1 1 0 0 0 6 19h12a1 1 0 0 0 .71-1.71L18 17z"/>
  </svg>
</div>
                            <span class="menu-item-label">Notifica√ß√µes</span>
                             <div class="menu-item-chevron"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9.29 15.88L13.17 12 9.29 8.12a.996.996 0 111.41-1.41l4.59 4.59c.39.39.39 1.02 0 1.41L10.7 17.3a.996.996 0 01-1.41 0c-.38-.39-.39-1.03 0-1.42z"></path></svg></div>
                        </div>

                        <div class="profile-menu-item" @click="logout">
                            <div class="menu-item-icon logout">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
    <path d="M16 13v-2H7V8l-5 4 5 4v-3zM20 3h-8a2 2 0 0 0-2 2v4h2V5h8v14h-8v-4h-2v4a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/>
  </svg>
</div>
                            <span class="menu-item-label">Sair</span>
                             <div class="menu-item-chevron"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9.29 15.88L13.17 12 9.29 8.12a.996.996 0 111.41-1.41l4.59 4.59c.39.39.39 1.02 0 1.41L10.7 17.3a.996.996 0 01-1.41 0c-.38-.39-.39-1.03 0-1.42z"></path></svg></div>
                        </div>
                    </div>
                </div>

                <div v-else-if="profileSubView === 'edit'">
                    <div class="page-header">
                        <button @click="profileSubView = 'main'" class="back-button-profile">
                             <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"></path></svg>
                        </button>
                        <h2>Editar Perfil</h2>
                    </div>

                    <form class="profile-form" @submit.prevent="saveProfile">
                        <div class="form-group">
                            <label for="foto">Foto de Perfil</label>
                            <input type="file" ref="fileInput" @change="handlePictureUpload" accept="image/*" style="display: none;">
                            <div style="display:flex; align-items:center; gap: 1rem;">
                                <img :src="userProfile.fotoUrl || 'https://cdn.shopify.com/s/files/1/0927/1286/1998/files/266033.png?v=1750354671'" alt="Foto do Perfil" class="profile-picture" style="width: 70px; height: 70px;">
                                <button type="button" @click="triggerFileUpload" class="save-button" style="width: auto; padding: 0.7rem 1rem;">Alterar Foto</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="nome">Nome Completo</label>
                            <input type="text" id="nome" v-model="userProfile.nome" placeholder="Digite seu nome completo">
                        </div>
                        <div class="form-group">
                            <label for="email">E-mail</label>
                            <input type="email" id="email" v-model="userProfile.email" placeholder="seu.email@provedor.com">
                        </div>
                        <div class="form-group">
                            <label for="telefone">Telefone / WhatsApp</label>
                            <input type="tel" id="telefone" v-model="userProfile.telefone" placeholder="(99) 99999-9999" required>
                        </div>
                        <div class="form-group">
                            <label for="atuacao">√Årea de Atua√ß√£o</label>
                            <input type="text" id="atuacao" v-model="userProfile.atuacao" placeholder="Ex: Varejo, Moda, etc.">
                        </div>
                        <div class="form-group">
    <label for="cep">CEP</label>
    <input type="text" id="cep" v-model="userProfile.cep" placeholder="00000-000" required>
</div>
<div class="form-group">
    <label for="logradouro">Logradouro (Rua, Av.)</label>
    <input type="text" id="logradouro" v-model="userProfile.logradouro" placeholder="Ex: Av. Paulista" required>
</div>
<div class="form-group">
    <label for="numero">N√∫mero</label>
    <input type="text" id="numero" v-model="userProfile.numero" placeholder="Ex: 1000" required>
</div>
<div class="form-group">
    <label for="bairro">Bairro</label>
    <input type="text" id="bairro" v-model="userProfile.bairro" placeholder="Ex: Bela Vista" required>
</div>
<div class="form-group">
    <label for="cidade">Cidade</label>
    <input type="text" id="cidade" v-model="userProfile.cidade" placeholder="Ex: S√£o Paulo" required>
</div>
<div class="form-group">
    <label for="uf">Estado (UF)</label>
    <select id="uf" v-model="userProfile.uf" required class="form-group input" style="appearance: auto; padding: 0.9rem !important;">
        <option disabled value="">Selecione o Estado</option>
        <option value="AC">Acre</option>
        <option value="AL">Alagoas</option>
        <option value="AP">Amap√°</option>
        <option value="AM">Amazonas</option>
        <option value="BA">Bahia</option>
        <option value="CE">Cear√°</option>
        <option value="DF">Distrito Federal</option>
        <option value="ES">Esp√≠rito Santo</option>
        <option value="GO">Goi√°s</option>
        <option value="MA">Maranh√£o</option>
        <option value="MT">Mato Grosso</option>
        <option value="MS">Mato Grosso do Sul</option>
        <option value="MG">Minas Gerais</option>
        <option value="PA">Par√°</option>
        <option value="PB">Para√≠ba</option>
        <option value="PR">Paran√°</option>
        <option value="PE">Pernambuco</option>
        <option value="PI">Piau√≠</option>
        <option value="RJ">Rio de Janeiro</option>
        <option value="RN">Rio Grande do Norte</option>
        <option value="RS">Rio Grande do Sul</option>
        <option value="RO">Rond√¥nia</option>
        <option value="RR">Roraima</option>
        <option value="SC">Santa Catarina</option>
        <option value="SP">S√£o Paulo</option>
        <option value="SE">Sergipe</option>
        <option value="TO">Tocantins</option>
    </select>
</div>
                        <div class="form-group">
                            <label for="empresa">Empresa (Opcional)</label>
                            <input type="text" id="empresa" v-model="userProfile.empresa" placeholder="Nome da sua empresa">
                        </div>
                        <div class="form-group">
                            <label for="cnpj">CNPJ (Opcional)</label>
                            <input type="text" id="cnpj" v-model="userProfile.cnpj" placeholder="00.000.000/0000-00">
                        </div>
                        <button type="submit" class="save-button">Salvar Altera√ß√µes</button>
                    </form>
                </div>
            </div>

            <div v-else-if="currentView === 'search'" class="page search-page">
                <div class="search-header">
                    <button @click="changeView('home')" class="back-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"></path></svg>
                    </button>
                    <h2>Pesquisar</h2>
                </div>

                <div class="search-input-container">
                    <input type="text" v-model="searchQuery" placeholder="Pesquisar produtos..." class="search-input">
                </div>

                <div class="filters-container">
                    <div class="filter-group">
                        <h3>Categorias</h3>
                        <div class="filter-options">
                            <button class="filter-button" :class="{ active: searchFilters.category === null }" @click="searchFilters.category = null">Todas</button>
                            <button v-for="category in categories" :key="category.id" 
                                    class="filter-button" 
                                    :class="{ active: searchFilters.category === category.id }" 
                                    @click="searchFilters.category = category.id">
                                {{ category.nome }}
                            </button>
                        </div>
                    </div>

                    <div class="filter-group">
                        <h3>Pre√ßo</h3>
                        <div class="filter-price-inputs">
                            <input type="number" v-model.number="searchFilters.minPrice" placeholder="M√≠n." min="0" @input="updatePriceFilter">
                            <span>-</span>
                            <input type="number" v-model.number="searchFilters.maxPrice" placeholder="M√°x." min="0" @input="updatePriceFilter">
                        </div>
                    </div>
                    <button class="save-button" @click="clearSearchFilters" style="background-color: #7A4E2D;">Limpar Filtros</button>

                </div>

                <div v-if="filteredAndSearchedProducts.length > 0" class="search-results-grid">
                    <div v-for="product in filteredAndSearchedProducts" :key="product.id" @click="showProductDetail(product)" class="product-card">
                        <div class="wishlist-icon" :class="{active: isInWishlist(product.id)}" @click.stop="toggleWishlist(product)">
                            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        </div>
                        <div class="product-card-image-wrapper"><img :src="product.imagem" :alt="product.nome" loading="lazy"></div>
                        <div class="product-info">
                            <h3>{{ product.nome }}</h3>
                            <template v-if="product.precoPromocionalAtivo && product.mostrarPrecoPromocional && product.precoPromocional !== null">
                                <span style="text-decoration:line-through; opacity:0.5; font-size:0.9em; margin-right:0.5em;">
                                    {{ formatCurrency(product.preco) }}
                                </span>
                                <span style="color:var(--primary-color); font-weight:700;">
                                    {{ formatCurrency(product.precoPromocional) }}
                                </span>
                            </template>
                            <template v-else>
                                <p>{{ formatCurrency(product.preco) }}</p>
                            </template>
                        </div>
                    </div>
                </div>
                <div v-else class="empty-search-results">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="48" height="48" style="color: #ccc; margin-bottom: 1rem;"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"></path></svg>
                    <p>Nenhum produto encontrado com os filtros e termos de pesquisa atuais.</p>
                </div>
            </div>

              <!-- NOVO: Tela de Suporte (Placeholder) -->
 
<!-- TELA DE SUPORTE COMPLETA - SUBSTITUA O BLOCO v-else-if="currentView === 'suporte'" INTEIRO POR ISTO -->
<div v-if="currentView === 'suporte'" class="page chat-page">
    
    <!-- TELA DE SELE√á√ÉO DE SUPORTE -->
    <div v-if="supportView === 'selection'" style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; padding: 2rem 1rem; text-align: center;">
        <img src="https://cdn.shopify.com/s/files/1/0927/1286/1998/files/Design_sem_nome_-_2025-06-13T102227.591.png?v=1750256134" alt="Logo Suporte" style="width: 120px; margin-bottom: 2rem;">
        <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Como podemos ajudar?</h2>
        <p style="color: var(--text-color-secondary); margin-bottom: 2.5rem;">Escolha uma das op√ß√µes abaixo para iniciar.</p>

        <div style="display: flex; flex-direction: column; gap: 1rem; width: 100%; max-width: 400px;">
            <!-- Bot√£o Falar com IA -->
            <button @click="startChat('ia')" class="profile-menu-item">
                <div class="menu-item-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-12h2v2h-2zm0 4h2v6h-2z"/></svg></div>
                <span class="menu-item-label">Falar com a IA (R√°pido)</span>
                <div class="menu-item-chevron"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9.29 15.88L13.17 12 9.29 8.12a.996.996 0 111.41-1.41l4.59 4.59c.39.39.39 1.02 0 1.41L10.7 17.3a.996.996 0 01-1.41 0c-.38-.39-.39-1.03 0-1.42z"></path></svg></div>
            </button>
            <!-- Bot√£o Falar com Especialista -->
            <button @click="startChat('humano')" class="profile-menu-item">
                <div class="menu-item-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M21 11.01L3 11v2h18zM3 16h12v2H3zM21 6H3v2.01L21 8z"/></svg></div>
                <span class="menu-item-label">Falar com um Especialista</span>
                <div class="menu-item-chevron"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9.29 15.88L13.17 12 9.29 8.12a.996.996 0 111.41-1.41l4.59 4.59c.39.39.39 1.02 0 1.41L10.7 17.3a.996.996 0 01-1.41 0c-.38-.39-.39-1.03 0-1.42z"></path></svg></div>
            </button>
            <!-- Bot√£o WhatsApp -->
            <button @click="openWhatsAppChat" class="profile-menu-item">
                <div class="menu-item-icon" style="color: #25D366;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2 22l5.25-1.38c1.45.79 3.08 1.21 4.79 1.21 5.46 0 9.91-4.45 9.91-9.91S17.5 2 12.04 2zM12.04 20.1c-1.53 0-3.03-.39-4.36-1.12l-.31-.18-3.24.85.87-3.17-.2-.33c-.8-1.37-1.22-2.94-1.22-4.57 0-4.54 3.69-8.23 8.24-8.23 4.54 0 8.23 3.69 8.23 8.23s-3.69 8.23-8.23 8.23zm4.49-5.49c-.25-.12-1.47-.72-1.7-.82s-.39-.12-.56.12c-.17.25-.64.82-.79.98s-.29.17-.54.06c-.25-.12-1.06-.39-2.02-1.25s-1.45-1.95-1.62-2.29c-.17-.34-.02-.53.11-.65.11-.11.25-.29.37-.43s.17-.25.25-.42c.08-.17.04-.31-.02-.43s-.56-1.34-.76-1.84c-.2-.48-.41-.42-.56-.42h-.48c-.17 0-.43.06-.66.31s-.87.85-1.07 2.07c-.2 1.22.89 2.4 1.01 2.56s1.76 2.67 4.27 3.77c.59.26 1.05.41 1.41.52.59.19 1.13.16 1.56.1.48-.06 1.47-.6 1.68-1.18s.21-1.09.15-1.18c-.06-.09-.17-.15-.25-.2z"/></svg></div>
                <span class="menu-item-label">Falar no WhatsApp</span>
                <div class="menu-item-chevron"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9.29 15.88L13.17 12 9.29 8.12a.996.996 0 111.41-1.41l4.59 4.59c.39.39.39 1.02 0 1.41L10.7 17.3a.996.996 0 01-1.41 0c-.38-.39-.39-1.03 0-1.42z"></path></svg></div>
            </button>
        </div>
    </div>

    <!-- TELA DE CHAT (VIS√çVEL AP√ìS SELE√á√ÉO) -->
    <div v-else-if="supportView === 'chat'" style="display: flex; flex-direction: column; height: 100%;">
        <header class="chat-header">
            <img src="https://cdn.shopify.com/s/files/1/0927/1286/1998/files/Design_sem_nome_-_2025-06-13T102227.591.png?v=1750256134" alt="Logo Suporte">
            <div class="chat-header-info">
                <h3>Suporte Cajuia</h3>
                <p>Normalmente responde em poucos minutos</p>
            </div>
        </header>

        <div class="chat-messages-container" ref="messagesContainer">
            <div v-for="message in chatMessages" :key="message.id" 
                 class="message-bubble" 
                 :class="message.remetente_id === supabaseUser?.id ? 'sent' : 'received'">

                <div class="message-content-wrapper">
                    <!-- Contexto de Resposta -->
                    <div v-if="message.replyingTo" class="reply-context">
                        <strong>{{ message.replyingTo.author }}</strong>
                        <p>{{ message.replyingTo.content }}</p>
                    </div>

                    <!-- Anexo de Imagem -->
                    <img v-if="message.attachment?.type === 'image'" :src="message.attachment.url" class="message-image-attachment" alt="Anexo de imagem">
                    
                    <!-- Anexo de Arquivo -->
                    <div v-if="message.attachment?.type === 'file'" class="message-file-attachment">
                        <div class="file-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"></path></svg>
                        </div>
                        <div class="file-info">
                            <p>{{ message.attachment.name }}</p>
                            <span>{{ message.attachment.size }}</span>
                        </div>
                    </div>

                    <!-- Conte√∫do de Texto -->
                    <p class="message-content">{{ message.conteudo }}</p>
                </div>
                
                <div class="message-meta">
                    <span v-if="message.isEdited" class="edited-indicator">editado</span>
                    <span>{{ formatMessageTime(message.enviada_em) }}</span>
                    <span v-if="message.remetente_id === supabaseUser?.id" class="read-receipts">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.62 16.2a1 1 0 01-1.41 0L5.62 11.62a1 1 0 011.41-1.41L11 13.17l9.83-9.83a1 1 0 011.41 1.41zM.41 13.03l1.41-1.41L7 16.2l-1.41 1.41L.41 13.03z"></path></svg>
                    </span>
                </div>
            </div>
        </div>

        <div class="chat-input-area">
            <button class="icon-button" @click="openAttachmentMenu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 015 0v10.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5V6H10v9.5a2.5 2.5 0 005 0V5c-2.21 0-4 1.79-4 4v11.5c0 2.76 2.24 5 5 5s5-2.24 5-5V6h-1.5z"></path></svg>
            </button>
            <textarea v-model="newMessageText" @input="adjustTextareaHeight" ref="messageInput" placeholder="Digite uma mensagem..." rows="1"></textarea>
            
            <!-- Bot√£o din√¢mico: Enviar ou Gravar √Åudio -->
            <button class="icon-button" @click="newMessageText ? sendMessage() : startRecordingAudio()">
                <svg v-if="newMessageText" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                <svg v-else xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.49 6-3.31 6-6.72h-1.7z"></path></svg>
            </button>
        </div>
    </div>
</div>

            
            <div v-else class="page" style="text-align: center; padding-top: 100px;">
                <h2 style="text-transform: capitalize;">{{ currentView }}</h2>
                <p>Funcionalidade em desenvolvimento.</p>
            </div>
            </transition>

        
        <transition name="slide-up">
            <div v-if="selectedProduct" class="product-detail-page">
                <div class="detail-header">
                    <button @click="closeProductDetail" class="back-button">
                         <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"></path></svg>
                    </button>
            </div>
                <!-- Bloco para galeria de imagens com thumbnails -->
<div class="product-image-gallery">
  <img
    :src="selectedProduct.imagensVariacoes && selectedProduct.imagensVariacoes[activeImageIndex] ? selectedProduct.imagensVariacoes[activeImageIndex] : selectedProduct.imagem"
    class="product-detail-image"
    @click="isZoomModalVisible = true; zoomImage = selectedProduct.imagensVariacoes && selectedProduct.imagensVariacoes[activeImageIndex] ? selectedProduct.imagensVariacoes[activeImageIndex] : selectedProduct.imagem"
    style="width: 100%; height: 60vh; object-fit: cover; border-radius: 12px; cursor: pointer;"
  >
  <div v-if="selectedProduct.imagensVariacoes && selectedProduct.imagensVariacoes.filter(i => i).length > 1" style="display: flex; gap: 8px; margin-top: 12px; justify-content: center;">
    <img
      v-for="(img, idx) in selectedProduct.imagensVariacoes.filter(i => i)"
      :key="idx"
      :src="img"
      @click="activeImageIndex = idx"
      :class="{ 'active-thumb': activeImageIndex === idx }"
      style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 2px solid #eee; cursor: pointer; transition: border-color 0.2s;"
    >
  </div>
</div>
                 <div class="product-detail-content">
                    <div class="detail-title-row">
                        <h1>{{ selectedProduct.nome }}</h1>
                        <div class="wishlist-icon" :class="{active: isInWishlist(selectedProduct.id)}" @click="toggleWishlist(selectedProduct)">
                           <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        </div>
                    </div>
                    <template v-if="selectedProduct.precoPromocionalAtivo && selectedProduct.mostrarPrecoPromocional && selectedProduct.precoPromocional !== null">
  <span class="product-price-highlight">
    <span style="text-decoration:line-through; opacity:0.5; font-size:1.1rem; margin-right:0.5em;">
      {{ formatCurrency(selectedProduct.preco) }}
    </span>
    <span style="color:var(--primary-color); font-weight:700; font-size:1.5rem;">
      {{ formatCurrency(selectedProduct.precoPromocional) }}
    </span>
  </span>
</template>
<template v-else>
  <span class="product-price-highlight">{{ formatCurrency(selectedProduct.preco) }}</span>
</template>
                    <p class="description">{{ selectedProduct.descricao }}</p>
                    <div style="display: flex; gap: 2rem;">
                        <!-- Bloco para varia√ß√µes respeitando as flags -->
<div style="display: flex; gap: 2rem;">
  <div class="variation-group"
       v-if="selectedProduct.habilitarTamanhos && selectedProduct.variacoes.tamanhos && selectedProduct.variacoes.tamanhos.length">
    <h3>Tamanho</h3>
    <div class="options-container">
      <button v-for="size in selectedProduct.variacoes.tamanhos" :key="size"
              @click="selection.size = size"
              class="size-button"
              :class="{ active: selection.size === size }">{{ size }}</button>
    </div>
  </div>
  <div class="variation-group"
       v-if="selectedProduct.habilitarCores && selectedProduct.variacoes.cores && selectedProduct.variacoes.cores.length">
    <h3>Cor</h3>
    <div class="options-container">
      <button v-for="color in selectedProduct.variacoes.cores" :key="color"
              @click="selection.color = color"
              class="color-button"
              :style="{ backgroundColor: color.toLowerCase() }"
              :class="{ active: selection.color === color }"></button>
    </div>
  </div>
</div>
                    </div>
                </div>
                <div class="add-to-cart-wrapper">
                    <div class="quantity-selector">
                        <button @click="selection.quantity > 1 ? selection.quantity-- : 1">-</button>
                        <span>{{ selection.quantity }}</span>
                        <button @click="selection.quantity++">+</button>
                    </div>
                    <button @click="addToCart" :disabled="!isSelectionValid" class="add-to-cart-button">Adicionar ao Carrinho</button>
                </div>
            </div>
        </transition>

        <transition name="fade">
  <div v-if="showShippingModal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:4000;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;">
    <div style="background:#fff;max-width:95vw;width:400px;padding:2rem 1.5rem;border-radius:18px;box-shadow:0 8px 32px rgba(0,0,0,0.18);position:relative;">
      <h2 style="margin-bottom:1rem;text-align:center;">Escolha a Transportadora</h2>
      <div style="max-height:350px;overflow-y:auto;">
        <div v-for="option in shippingOptionsSorted" :key="option.id"
             @click="selectShippingOption(option)"
             style="display:flex;align-items:center;gap:12px;cursor:pointer;padding:1rem;border-radius:12px;margin-bottom:10px;transition:background 0.2s;"
             :style="{background: selectedShipping && selectedShipping.id === option.id ? '#eafaf1' : '#f8f8f8', border: selectedShipping && selectedShipping.id === option.id ? '2px solid #2d7a4e' : '1px solid #eee'}">
          <img :src="option.company.picture" :alt="option.company.name" style="width:48px;height:48px;border-radius:8px;background:#fff;">
          <div style="flex:1;">
            <div style="font-weight:600;">{{ option.company.name }} <span style="font-size:0.95em;color:#888;">({{ option.name }})</span></div>
            <div style="color:#2d7a4e;font-weight:700;font-size:1.1em;">{{ formatCurrency(parseFloat(option.price)) }}</div>
            <div style="font-size:0.95em;color:#888;">Prazo: {{ option.delivery_time }} dias</div>
          </div>
        </div>
      </div>
      <button @click="showShippingModal = false" class="save-button" style="width:100%;margin-top:1rem;background:#eee;color:#7A4E2D;">Fechar</button>
    </div>
  </div>
</transition>

        <transition name="fade">
             <div v-if="isZoomModalVisible" class="zoom-modal" @click="isZoomModalVisible = false">
                <img :src="zoomImage" alt="Zoomed product image">
            </div>
        </transition>
        
        <transition name="fade">
  <div v-if="showCheckoutModal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:3000;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;">
    <div style="background:#fff;max-width:95vw;width:400px;padding:2rem 1.5rem;border-radius:18px;box-shadow:0 8px 32px rgba(0,0,0,0.18);position:relative;">
      <h2 style="margin-bottom:1rem;text-align:center;">Pagamento</h2>
      <p style="margin-bottom:1.2rem;text-align:center;">Clique no bot√£o abaixo para acessar o checkout de pagamento:</p>
      <iframe :src="checkoutUrl" style="width:100%;height:400px;border:none;border-radius:10px;margin-bottom:1rem;"></iframe>
        Ir para o Pagamento
      </a>
      <button @click="showCheckoutModal = false" style="width:100%;background:#eee;color:#7A4E2D;padding:0.9rem 0;border:none;border-radius:10px;font-weight:600;cursor:pointer;">
        Retornar ao Cajuia
      </button>
    </div>
  </div>
</transition>

        <nav class="bottom-nav">
            <div class="nav-item" :class="{ active: currentView === 'home' }" @click="changeView('home')">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20V14H14V20H19V12H22L12 3L2 12H5V20H10Z"></path></svg>
                <span>In√≠cio</span>
            </div>
            <div class="nav-item" :class="{ active: currentView === 'wishlist' }" @click="changeView('wishlist')">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 .81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                <span>Favoritos</span>
            </div>
            <div class="nav-item" :class="{ active: currentView === 'suporte' }" @click="changeView('suporte')">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                <span>Suporte</span>
            </div>
            <div class="nav-item" :class="{ active: currentView === 'profile' }" @click="changeView('profile')">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"></path></svg>
                <span>Perfil</span>
            </div>
        </nav>

    </main>

     <!-- NOVO: Overlay de Pesquisa -->
    <transition name="fade">
        <div v-if="isSearchOverlayVisible" class="search-overlay">
            <div class="search-overlay-header">
                <input type="text" v-model="searchQuery" placeholder="Pesquisar produtos..." class="search-input-overlay" autofocus>
                <button class="close-overlay-btn" @click="closeSearchOverlay">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
<div class="search-overlay-content">
    <div class="filters-container-overlay">
        <div class="filter-group">
            <h3>Categorias</h3>
            <div class="filter-options">
                <button class="filter-button" :class="{ active: searchFilters.category === null }" @click="searchFilters.category = null">Todas</button>
                <button v-for="category in categories" :key="category.id" class="filter-button" :class="{ active: searchFilters.category === category.id }" @click="searchFilters.category = category.id">{{ category.nome }}</button>
            </div>
        </div>
        <div class="filter-group">
            <h3>Pre√ßo (R$)</h3>
            <div class="filter-price-inputs">
                <input type="number" v-model.number="searchFilters.minPrice" placeholder="M√≠n." min="0">
                <span>-</span>
                <input type="number" v-model.number="searchFilters.maxPrice" placeholder="M√°x." min="0">
            </div>
        </div>
    </div>

    <div v-if="filteredAndSearchedProducts.length > 0" class="search-results-grid">
        <div v-for="product in filteredAndSearchedProducts" :key="product.id" @click="showProductDetail(product); closeSearchOverlay();" class="product-card">
            <div class="product-card-image-wrapper"><img :src="getActiveProductImage(product)" :alt="product.nome" loading="lazy"></div>
            <div class="product-info">
                <h3>{{ product.nome }}</h3>
                <template v-if="product.precoPromocionalAtivo && product.mostrarPrecoPromocional && product.precoPromocional !== null">
                    <span style="text-decoration:line-through; opacity:0.5;">{{ formatCurrency(product.preco) }}</span>
                    <span style="color:var(--primary-color); font-weight:700;">{{ formatCurrency(product.precoPromocional) }}</span>
                </template>
                <template v-else><p>{{ formatCurrency(product.preco) }}</p></template>
            </div>
        </div>
    </div>
    
    <div v-if="hasActiveFilters && filteredAndSearchedProducts.length === 0" class="empty-results-textured">
        <span>=(</span>
        <p>Nenhum resultado<br>encontrado</p>
    </div>
</div>
        </div>
    </transition>

  
    
</div>

<script>
    const { createApp } = Vue;
    const supabase = window.supabase.createClient(
        'https://qmiptiariyjekecvyalo.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtaXB0aWFyaXlqZWtlY3Z5YWxvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2NjkwMjMsImV4cCI6MjA2NjI0NTAyM30.Ue2WkDZ9_E89CvDOgUsT_-v6_WepP1bqCL1hLJ648BM'
    );

    createApp({
        data() {
            return {
                
                messageSubscription: null,
                supportView: 'selection', // Pode ser 'selection' ou 'chat'
                chatMessages: [], // Ser√° preenchido com dados do Supabase
                currentConversation: null, // Guarda o ID e status da conversa atual
                newMessageText: '', // Ligado ao textarea
                replyingToMessage: null, // Guarda a mensagem que est√° sendo respondida
                editingMessage: null, // Guarda a mensagem que est√° sendo editada
                isSearchOverlayVisible: false,
                zoomImage: '',
                isLoading: true,
                errorOnLoad: false,
                currentView: 'home',
                apiUrl: 'https://cajuia.onrender.com/backend_cajuia.json',
                phoneNumber: '5515997637941',
                personalizacao: { heroAtivo: false, heroBanners: [] },
                categories: [],
                products: [],
                cart: [],
                wishlist: [],
                selectedProduct: null,
                selection: { size: null, color: null, quantity: 1 },
                isZoomModalVisible: false,
                selectedCategoryId: null,
                swipeState: {},
                userProfile: { fotoUrl: '', nome: '', email: '', telefone: '', empresa: '', cnpj: '', atuacao: '',  logradouro: '', numero: '', bairro: '', cidade: '', uf: '', cep: ''},
                profileNotification: { show: false, message: '', type: 'success' },
                profileSubView: 'main', 
                // L√≥gica do Carrossel movida para aqui
                currentSlide: 0,
                autoPlayInterval: null,

                showCheckoutModal: false,
                checkoutUrl: "",
                valorFrete: null,
                enderecoFrete: null,

                shippingOptions:[],
                selectedShipping: null,
                showShippingModal: false,

                // --- Novas Vari√°veis para Autentica√ß√£o
                authView: null, // 'login', 'register', or null
                authLoading: false,
                authError: '',
                loginForm: { email: '', password: '' },
                registerForm: { nome: '', email: '', password: '' },
                supabaseUser: null,

                // --- Novas Vari√°veis para a funcionalidade de Pesquisa
                searchQuery: '',
                searchFilters: {
                    category: null, // null para todas as categorias
                    minPrice: null,
                    maxPrice: null
                }
            };
            
        },
        computed: {
            showVideoBackground() {
        // Mostra o v√≠deo se estiver carregando OU se a tela for de login/registro
        return this.isLoading || this.authView !== null;
    },
            hasActiveFilters() {
        return this.searchQuery.length > 0 ||
               this.searchFilters.category !== null ||
               this.searchFilters.minPrice !== null ||
               this.searchFilters.maxPrice > 0;
    },
            shippingOptionsSorted() {
        return [...this.shippingOptions].sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
    },
            filteredProducts() {
                if (!this.selectedCategoryId) return this.products;
                return this.products.filter(p => p.categoriaId === this.selectedCategoryId);
            },
            cartItemCount() { return this.cart.reduce((total, item) => total + item.quantity, 0); },
            cartTotalPrice() {
    return this.cart.reduce((total, item) => {
        if (item.selected) {
            const product = this.getProductById(item.product_id);
            if (product) {
                // USA A FUN√á√ÉO INTELIGENTE PARA PEGAR O PRE√áO CORRETO
                const priceToUse = this.getActiveProductPrice(product);
                return total + (priceToUse * item.quantity);
            }
            return total;
        }
        return total;
    }, 0);
},
            isSelectionValid() {
    if (!this.selectedProduct) return false;

    // VERIFICA√á√ÉO ATUALIZADA: A sele√ß√£o S√ì √â NECESS√ÅRIA se a varia√ß√£o estiver HABILITADA e tiver OP√á√ïES.
    const needsSizeSelection = this.selectedProduct.habilitarTamanhos && this.selectedProduct.variacoes.tamanhos && this.selectedProduct.variacoes.tamanhos.length > 0;
    const needsColorSelection = this.selectedProduct.habilitarCores && this.selectedProduct.variacoes.cores && this.selectedProduct.variacoes.cores.length > 0;

    // A l√≥gica de valida√ß√£o agora checa se a sele√ß√£o √© necess√°ria.
    const sizeIsValid = !needsSizeSelection || this.selection.size !== null;
    const colorIsValid = !needsColorSelection || this.selection.color !== null;

    return sizeIsValid && colorIsValid;
},
            wishlistProducts() {
                return this.products.filter(p => this.wishlist.includes(p.id));
            },
            relatedProducts() {
                if (this.products.length === 0) return [];
                const cartproduct_ids = this.cart.map(item => item.product_id);
                const availableProducts = this.products.filter(p => !cartproduct_ids.includes(p.id));
                return availableProducts.sort(() => 0.5 - Math.random()).slice(0, 6);
            },
            userFirstName() {
                if (!this.userProfile.nome) return 'Visitante';
                return this.userProfile.nome.split(' ')[0];
            },
            timeBasedGreeting() {
                const hour = new Date().getHours();
                if (hour >= 5 && hour < 12) {
                    return { text: 'Bom dia', emoji: '‚òÄÔ∏è' };
                } else if (hour >= 12 && hour < 18) {
                    return { text: 'Boa tarde', emoji: 'üå§Ô∏è' };
                } else {
                    return { text: 'Boa noite', emoji: 'üåô' };
                }
            },
            // Nova propriedade computada para produtos filtrados e pesquisados
            filteredAndSearchedProducts() {
                let tempProducts = this.products;

                // Filtrar por termo de pesquisa
                if (this.searchQuery) {
                    const query = this.searchQuery.toLowerCase();
                    tempProducts = tempProducts.filter(product => 
                        product.nome.toLowerCase().includes(query) ||
                        (product.descricao && product.descricao.toLowerCase().includes(query)) ||
                        (product.tipo && product.tipo.toLowerCase().includes(query))
                    );
                }

                // Filtrar por categoria
                if (this.searchFilters.category !== null) {
                    tempProducts = tempProducts.filter(product => 
                        product.categoriaId === this.searchFilters.category
                    );
                }

                // Filtrar por pre√ßo m√≠nimo
                // Novo bloco do Pre√ßo M√≠nimo
                    if (this.searchFilters.minPrice !== null && this.searchFilters.minPrice >= 0) {
                        tempProducts = tempProducts.filter(product => 
                            // Agora usa o pre√ßo ativo (normal ou promocional) para a compara√ß√£o
                            this.getActiveProductPrice(product) >= this.searchFilters.minPrice
                        );
                    }
                    
                    // Novo bloco do Pre√ßo M√°ximo
                    if (this.searchFilters.maxPrice !== null && this.searchFilters.maxPrice >= 0) {
                        tempProducts = tempProducts.filter(product => 
                            // Agora usa o pre√ßo ativo (normal ou promocional) para a compara√ß√£o
                            this.getActiveProductPrice(product) <= this.searchFilters.maxPrice
                        );
                    }

                return tempProducts;
            },

            categoriesWithCount() {
        return this.categories.map(cat => ({
            ...cat,
            produtosCount: this.products.filter(p => p.categoriaId === cat.id).length
        }));
    }
        },
       watch: {
    currentView(newView) {
        if (newView !== 'suporte') {
            this.supportView = 'selection';
            if (this.messageSubscription) {
                supabase.removeChannel(this.messageSubscription);
                this.messageSubscription = null;
            }
        }
        if (newView === 'profile' && this.supabaseUser) {
            this.fetchProfile();
        }
    },
    userProfile: {
        handler(newProfile) {
            localStorage.setItem('cajuia-user-profile', JSON.stringify(newProfile));
        },
        deep: true
    }
},
        async mounted() {
            

            tsParticles.load({
        id: "particles-container", // ID do cont√™iner que colocamos no HTML
        options: {
            background: { color: { value: "transparent" } },
            fpsLimit: 60,
            interactivity: {
                events: {
                    onHover: { enable: true, mode: "repulse" },
                },
                modes: {
                    repulse: { distance: 100, duration: 0.4 },
                },
            },
            particles: {
                color: { value: "#ffffff" },
                links: { color: "#ffffff", distance: 150, enable: true, opacity: 0.1, width: 1 },
                move: {
                    direction: "none",
                    enable: true,
                    outModes: { default: "bounce" },
                    random: false,
                    speed: 0.5,
                    straight: false,
                },
                number: { density: { enable: true }, value: 80 },
                opacity: { value: 0.2 },
                shape: { type: "circle" },
                size: { value: { min: 1, max: 3 } },
            },
            detectRetina: true,
        },
    });
            
            const savedProfile = localStorage.getItem('cajuia-user-profile');
            if (savedProfile) { this.userProfile = JSON.parse(savedProfile); }

            try {
                const response = await fetch(this.apiUrl + '?t=' + new Date().getTime());
                if (!response.ok) throw new Error('Network response was not ok.');
                const data = await response.json();
                
                this.personalizacao = data.personalizacao || { heroAtivo: false, heroBanners: [] };
                this.categories = data.categorias;
                this.products = data.produtos.map(p => ({ ...p, tipo: p.tipo || 'Vestu√°rio' }));

                if (this.personalizacao.heroAtivo && this.personalizacao.heroBanners) {
                   this.startAutoPlay();
                }
            } catch (error) { 
                this.errorOnLoad = true; 
                console.error("Falha ao carregar dados:", error); 
            } finally { 
                setTimeout(() => { this.isLoading = false; }, 6500); 
            }

            // Autentica√ß√£o Supabase
            const { data: { session } } = await supabase.auth.getSession();
            if (session && session.user) {
                this.supabaseUser = session.user;
                this.authView = null;
                await this.fetchProfile();
                await this.fetchUserData();
            } else {
                this.authView = 'login';
            }
            supabase.auth.onAuthStateChange(async (event, session) => {
                if (session && session.user) {
                    this.supabaseUser = session.user;
                    this.authView = null;
                    await this.fetchProfile();
                    await this.fetchUserData();
                } else {
                    this.supabaseUser = null;
                    this.authView = 'login';
                    this.userProfile = { fotoUrl: '', nome: '', email: '', telefone: '', empresa: '', cnpj: '', atuacao: '', endereco: '' };
                }
            });

            // Verifica se veio token de confirma√ß√£o na URL
            const url = new URL(window.location.href);
            const type = url.searchParams.get('type');
            if (type === 'signup') {
                this.showProfileNotification('E-mail confirmado! Agora voc√™ pode fazer login.');
                this.authView = 'login';
                // Limpa a URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        },
        beforeUnmount() {
            this.stopAutoPlay();
        },
        methods: {
    // --- M√âTODOS DO CHAT (VERS√ÉO FUNCIONAL) ---
    async startChat(type) {
        this.supportView = 'chat';
        if (!this.supabaseUser) {
            alert("Voc√™ precisa estar logado para iniciar o suporte.");
            this.supportView = 'selection';
            return;
        }
        try {
            let { data: conversa, error } = await supabase.from('conversas').select('*').eq('user_id', this.supabaseUser.id).in('status', ['aberto', 'atendido']).single();
            if (error || !conversa) {
                const { data: novaConversa, error: insertError } = await supabase.from('conversas').insert({ user_id: this.supabaseUser.id, status: 'aberto' }).select().single();
                if (insertError) throw insertError;
                conversa = novaConversa;
            }
            if (type === 'humano' && conversa.status === 'aberto') {
                const { data: updatedConversa, error: updateError } = await supabase.from('conversas').update({ status: 'atendido' }).eq('id', conversa.id).select().single();
                if (updateError) throw updateError;
                conversa = updatedConversa;
            }
            this.currentConversation = conversa;
            await this.fetchMessages();
            this.subscribeToMessages();
        } catch (err) {
            console.error("Erro ao iniciar o chat:", err);
            alert("N√£o foi poss√≠vel iniciar o chat. Tente novamente.");
            this.supportView = 'selection';
        }
    },
    async fetchMessages() {
        if (!this.currentConversation) return;
        const { data, error } = await supabase.from('mensagens').select('*').eq('conversa_id', this.currentConversation.id).order('enviada_em', { ascending: true });
        if (error) { console.error("Erro ao buscar mensagens:", error); return; }
        this.chatMessages = data;
        this.scrollToBottom();
    },
    async sendMessage() {
    // 1. Validar se h√° texto e uma conversa ativa.
    if (this.newMessageText.trim() === '' || !this.currentConversation) {
        return;
    }

    // 2. [ATUALIZA√á√ÉO OTIMISTA] Criar um objeto tempor√°rio para a UI.
    // Isso faz o bal√£o da mensagem aparecer INSTANTANEAMENTE na tela.
    const optimisticMessage = {
        id: Date.now(), // ID tempor√°rio apenas para o Vue renderizar
        conversa_id: this.currentConversation.id,
        remetente_id: this.supabaseUser.id,
        conteudo: this.newMessageText.trim(),
        enviada_em: new Date().toISOString() // Data/hora local para exibi√ß√£o imediata
    };

    // Adiciona a mensagem √† lista local para o usu√°rio ver na hora.
    this.chatMessages.push(optimisticMessage);
    this.scrollToBottom();

    // 3. Preparar dados e limpar o campo de texto.
    const textToSave = this.newMessageText.trim();
    this.newMessageText = '';
    this.adjustTextareaHeight();
    
    // 4. [PERSIST√äNCIA] Tentar salvar a mensagem no Supabase.
    // Esta √© a linha que provavelmente foi removida ou quebrada.
    const { error } = await supabase.from('mensagens').insert({
        conversa_id: optimisticMessage.conversa_id,
        remetente_id: optimisticMessage.remetente_id,
        conteudo: textToSave // Usa o conte√∫do salvo
    });

    // 5. Lidar com erros.
    if (error) {
        console.error("Erro ao enviar mensagem:", error);
        alert("Sua mensagem n√£o p√¥de ser enviada. Tente novamente.");

        // Se deu erro, remove a mensagem otimista da tela.
        this.chatMessages = this.chatMessages.filter(
            msg => msg.id !== optimisticMessage.id
        );

        // Devolve o texto ao campo de input para o usu√°rio n√£o perder.
        this.newMessageText = textToSave;
    }
},
    subscribeToMessages() {
        if (this.messageSubscription) { supabase.removeChannel(this.messageSubscription); }
        this.messageSubscription = supabase.channel(`chat:${this.currentConversation.id}`)
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'mensagens', filter: `conversa_id=eq.${this.currentConversation.id}` }, 
            (payload) => {
                if (!this.chatMessages.some(msg => msg.id === payload.new.id)) {
                    this.chatMessages.push(payload.new);
                }
                this.scrollToBottom();
            })
            .subscribe();
    },
    openWhatsAppChat() {
        const defaultMessage = "Ol√°! Preciso de ajuda com um pedido.";
        window.location.href = `https://wa.me/${this.phoneNumber}?text=${encodeURIComponent(defaultMessage)}`;
    },
    formatMessageTime(timestamp) { return new Date(timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }); },
    scrollToBottom() { this.$nextTick(() => { const c = this.$refs.messagesContainer; if (c) c.scrollTop = c.scrollHeight; }); },
    adjustTextareaHeight() { this.$nextTick(() => { const t = this.$refs.messageInput; if (t) { t.style.height = 'auto'; t.style.height = (t.scrollHeight) + 'px'; } }); },
    openAttachmentMenu() { console.log('Abrindo menu de anexos...'); },
    startRecordingAudio() { console.log('Iniciando grava√ß√£o de √°udio...'); },

    // --- SEUS M√âTODOS EXISTENTES ---
    selectShippingOption(option) {
        this.selectedShipping = option;
        this.valorFrete = parseFloat(option.price);
        this.showShippingModal = false;
        this.showProfileNotification(`Frete selecionado: ${option.company.name} (${option.name}) - ${this.formatCurrency(this.valorFrete)}`);
    },
    openSearchOverlay() {
        this.isSearchOverlayVisible = true;
    },
    closeSearchOverlay() {
        this.isSearchOverlayVisible = false;
    },
    getActiveProductImage(product) {
        if (!product) {
            return '';
        }
        if (product.imagensVariacoes && product.imagensVariacoes.length > 0 && product.imagensVariacoes[0]) {
            return product.imagensVariacoes[0];
        }
        return product.imagem;
    },
    startAutoPlay() {
        const bannerCount = this.personalizacao.heroBanners.length;
        if (bannerCount <= 1) return;
        this.stopAutoPlay();
        this.autoPlayInterval = setInterval(() => {
            this.currentSlide = (this.currentSlide + 1) % bannerCount;
        }, 5000);
    },
    stopAutoPlay() {
        clearInterval(this.autoPlayInterval);
        this.autoPlayInterval = null;
    },
    goToSlide(index) {
        this.currentSlide = index;
        this.stopAutoPlay();
        this.startAutoPlay();
    },
    async fetchUserData() {
        if (!this.supabaseUser) return;
        try {
            const { data: cartData, error: cartError } = await supabase
                .from('user_cart')
                .select('*')
                .eq('user_id', this.supabaseUser.id);
            if (cartError) throw cartError;
            
            this.cart = cartData.map(item => ({
                ...item,
                cartItemId: item.id,
                selected: true 
            }));

            const { data: wishlistData, error: wishlistError } = await supabase
                .from('user_wishlist')
                .select('product_id')
                .eq('user_id', this.supabaseUser.id);
            if (wishlistError) throw wishlistError;
            this.wishlist = wishlistData.map(item => item.product_id);

        } catch (error) {
            console.error('Erro ao buscar dados do usu√°rio:', error.message);
        }
    },
    async calcularFrete() {
        if (!this.userProfile.cep) {
            alert("Informe o CEP no perfil.");
            return;
        }
        const cepDestino = this.userProfile.cep;
        const selectedItems = this.cart.filter(item => item.selected).map(item => {
            const product = this.getProductById(item.product_id);
            return {
                ...item,
                peso: product.peso,
                comprimento: product.comprimento,
                altura: product.altura,
                largura: product.largura,
                valor: product.valor
            };
        });
        try {
            const response = await fetch('https://cajuia.onrender.com/calcular-frete', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    cepDestino,
                    itens: selectedItems
                })
            });
            const result = await response.json();
            if (Array.isArray(result)) {
                this.shippingOptions = result.filter(opt => !opt.error);
                this.selectedShipping = null;
                this.showShippingModal = true;
            } else {
                alert('Erro ao calcular frete.');
            }
        } catch (e) {
            alert('Erro ao conectar ao servidor de frete.');
        }
    },
    formatCurrency(value) { return typeof value !== 'number' ? '' : value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); },
    changeView(view) {
        this.currentView = view;
        this.selectedProduct = null;
        if (view === 'profile') {
            this.profileSubView = 'main';
        }
        window.scrollTo(0, 0);
    },
    showProductDetail(product) {
        this.selectedProduct = product;
        this.selection = { size: null, color: null, quantity: 1 };
        this.activeImageIndex = 0;
    },
    closeProductDetail() { this.selectedProduct = null; },
    getProductById(id) { return this.products.find(p => p.id === id) || { preco: 0, nome: 'Produto n√£o encontrado', imagem: '', tipo: '' }; },
    getCategoryNameById(id) {
        const category = this.categories.find(c => c.id === id);
        return category ? category.nome : '';
    },
    async updateCartQuantity(cartItemId, change) {
        if (!this.supabaseUser) return;
        const item = this.cart.find(i => i.cartItemId === cartItemId);
        if (!item) return;
        const newQuantity = item.quantity + change;
        try {
            if (newQuantity <= 0) {
                await this.removeFromCart(cartItemId);
            } else {
                const { error } = await supabase.from('user_cart')
                    .update({ quantity: newQuantity })
                    .eq('id', cartItemId);
                if (error) throw error;
                await this.fetchUserData();
            }
        } catch (error) {
            console.error("Erro ao atualizar quantidade:", error.message);
        }
    },
    async removeFromCart(cartItemId) {
        if (!this.supabaseUser) return;
        try {
            const { error } = await supabase.from('user_cart')
                .delete()
                .eq('id', cartItemId);
            if (error) throw error;
            await this.fetchUserData();
        } catch (error) {
            console.error("Erro ao remover item do carrinho:", error.message);
        }
    },
    async addToCart() {
        if (!this.isSelectionValid || !this.supabaseUser) return;
        try {
            const { error } = await supabase.from('user_cart').insert({
                user_id: this.supabaseUser.id,
                product_id: this.selectedProduct.id,
                quantity: this.selection.quantity,
                size: this.selection.size,
                color: this.selection.color
            });
            if (error) throw error;
            await this.fetchUserData();
            this.closeProductDetail();
            this.changeView('cart');
        } catch (error) {
            console.error('Erro ao adicionar ao carrinho:', error.message);
        }
    },
    async finalizePurchase() {
        if (!this.userProfile.cep || !this.valorFrete || this.valorFrete <= 0) {
            alert("Por favor, calcule e selecione uma op√ß√£o de frete antes de finalizar a compra.");
            return;
        }
        if (!this.userProfile.logradouro || !this.userProfile.numero || !this.userProfile.bairro || !this.userProfile.cidade || !this.userProfile.uf) {
            alert("Endere√ßo incompleto! Por favor, v√° ao seu perfil e preencha todos os campos do seu endere√ßo.");
            this.changeView('profile');
            return;
        }
        if (!this.userProfile.telefone || this.userProfile.telefone.replace(/\D/g, '').length < 10) {
            alert("Telefone inv√°lido! Por favor, v√° ao seu perfil e preencha seu n√∫mero de telefone com DDD.");
            this.changeView('profile');
            return;
        }
        if (!this.userProfile.cnpj) {
            alert("CPF/CNPJ inv√°lido! Por favor, v√° ao seu perfil e preencha seu documento.");
            this.changeView('profile');
            return;
        }
        const selectedItems = this.cart.filter(item => item.selected);
        if (selectedItems.length === 0) {
            alert("Por favor, selecione ao menos um item para finalizar a compra.");
            return;
        }
        const validItemsToSend = selectedItems.map(item => {
            const product = this.getProductById(item.product_id);
            if (!product || !product.id) return null;
            return { nome: product.nome, quantidade: item.quantity, preco: this.getActiveProductPrice(product) };
        }).filter(item => item !== null);

        if (validItemsToSend.length === 0) {
            alert("N√£o foi poss√≠vel processar os itens do carrinho.");
            return;
        }
        try {
            const response = await fetch('https://cajuia.onrender.com/criar-link-pagarme', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    cliente: this.userProfile,
                    itens: validItemsToSend,
                    valor_frete: this.valorFrete
                })
            });
            
            const result = await response.json();
            if (result.url) {
                await supabase.from('pedidos').insert([{
                    user_id: this.supabaseUser.id,
                    valor_total: this.cartTotalPrice + this.valorFrete,
                    itens: validItemsToSend,
                    dados_entrega: this.userProfile,
                    status: 'pendente'
                }]);
                this.checkoutUrl = result.url;
                this.showCheckoutModal = true;
            } else {
                const errorMessage = result.error?.message || 'Erro ao gerar link de pagamento.';
                alert(errorMessage);
                console.error('Erro retornado pelo backend:', result);
            }
        } catch (e) {
            console.error('Erro de conex√£o:', e);
            alert('Erro ao conectar ao servidor de pagamento.');
        }
    },
    getActiveProductPrice(product) {
        if (!product) return 0;
        if (product.precoPromocionalAtivo && typeof product.precoPromocional === 'number') {
            return product.precoPromocional;
        }
        return product.preco;
    },
    sendOrderToWhatsApp() {
        const selectedItems = this.cart.filter(item => item.selected);
        if (selectedItems.length === 0) {
            alert("Por favor, selecione ao menos um item para finalizar a compra.");
            return;
        }
        let clientDataMessage = "üë§ *DADOS DO CLIENTE*\n";
        clientDataMessage += `*Nome:* ${this.userProfile.nome || 'N√£o informado'}\n`;
        clientDataMessage += `*E-mail:* ${this.userProfile.email || 'N√£o informado'}\n`;
        clientDataMessage += `*Telefone:* ${this.userProfile.telefone || 'N√£o informado'}\n`;
        if(this.userProfile.empresa) clientDataMessage += `*Empresa:* ${this.userProfile.empresa}\n`;
        if(this.userProfile.cnpj) clientDataMessage += `*CNPJ:* ${this.userProfile.cnpj}\n`;
        if(this.userProfile.atuacao) clientDataMessage += `*√Årea de Atua√ß√£o:* ${this.userProfile.atuacao}\n`;
        if(this.userProfile.endereco) clientDataMessage += `*Endere√ßo:* ${this.userProfile.endereco}\n`;
        clientDataMessage += "-----------------------------------\n\n";
        let orderMessage = "üõçÔ∏è *RESUMO DO PEDIDO*\nOl√°! ‚ú® Gostaria de fazer um pedido com os seguintes itens:\n\n";
        selectedItems.forEach(item => {
            const product = this.getProductById(item.product_id);
            if (product) {
                const subtotal = product.preco * item.quantity;
                orderMessage += `‚ñ™Ô∏è *${product.nome}*\n`;
                if (item.size) orderMessage += `    Tamanho: ${item.size}\n`;
                if (item.color) orderMessage += `    Cor: ${item.color}\n`;
                orderMessage += `    Qtd: ${item.quantity}\n`;
                orderMessage += `    Subtotal: ${this.formatCurrency(subtotal)}\n\n`;
            }
        });
        orderMessage += "-----------------------------------\n";
        orderMessage += `*Valor Total: ${this.formatCurrency(this.cartTotalPrice)}*\n\n`;
        orderMessage += "Aguardo seu contato para finalizar. Obrigada!";
        const finalMessage = clientDataMessage + orderMessage;
        window.location.href = `https://wa.me/${this.phoneNumber}?text=${encodeURIComponent(finalMessage)}`;
    },
    isInWishlist(product_id) { return this.wishlist.includes(product_id); },
    async toggleWishlist(product) {
        if (!this.supabaseUser) return;
        const isAlreadyInWishlist = this.wishlist.includes(product.id);
        try {
            if (isAlreadyInWishlist) {
                const { error } = await supabase.from('user_wishlist').delete().eq('user_id', this.supabaseUser.id).eq('product_id', product.id);
                if (error) throw error;
            } else {
                const { error } = await supabase.from('user_wishlist').insert({ user_id: this.supabaseUser.id, product_id: product.id });
                if (error) throw error;
            }
            await this.fetchUserData();
        } catch (error) {
            console.error("Erro ao atualizar favoritos:", error.message);
        }
    },
    async addWishlistToCart(product) {
        if (!this.supabaseUser) return;
        try {
            const { error: cartError } = await supabase.from('user_cart').insert({ user_id: this.supabaseUser.id, product_id: product.id, quantity: 1, size: null, color: null });
            if (cartError) {
                if (cartError.code === '23505') { this.showProfileNotification('Este item j√° est√° no seu carrinho.', 'error'); } 
                else { throw cartError; }
                return;
            }
            const { error: wishlistError } = await supabase.from('user_wishlist').delete().match({ user_id: this.supabaseUser.id, product_id: product.id });
            if (wishlistError) throw wishlistError;
            await this.fetchUserData();
            this.showProfileNotification(`'${product.nome}' foi adicionado ao carrinho!`, 'success');
            this.changeView('cart');
        } catch (error) {
            console.error('Erro ao mover item da wishlist para o carrinho:', error.message);
            this.showProfileNotification('Ocorreu um erro. Tente novamente.', 'error');
        }
    },
    toggleCartItemSelection(cartItemId) {
        const item = this.cart.find(i => i.cartItemId === cartItemId);
        if (item) item.selected = !item.selected;
    },
    handleTouchStart(cartItemId, event) {
        Object.keys(this.swipeState).forEach(id => { if (id != cartItemId) { this.swipeState[id].translateX = 0; this.swipeState[id].isSwiped = false; } });
        this.swipeState[cartItemId] = { startX: event.touches[0].clientX, currentX: event.touches[0].clientX, translateX: 0, isSwiping: false, isSwiped: false };
    },
    handleTouchMove(cartItemId, event) {
        if (!this.swipeState[cartItemId]) return;
        const state = this.swipeState[cartItemId];
        state.currentX = event.touches[0].clientX;
        let deltaX = state.currentX - state.startX;
        if (deltaX > 0) deltaX = 0;
        if (deltaX < -95) deltaX = -95;
        state.translateX = deltaX;
        state.isSwiping = true;
    },
    handleTouchEnd(cartItemId) {
        if (!this.swipeState[cartItemId]) return;
        const state = this.swipeState[cartItemId];
        const threshold = -50;
        if (state.translateX < threshold) { state.translateX = -90; state.isSwiped = true; } 
        else { state.translateX = 0; state.isSwiped = false; }
        state.isSwiping = false;
    },
    getSwipeStyle(cartItemId) {
        const state = this.swipeState[cartItemId];
        if (state) {
            const transition = state.isSwiping ? 'none' : 'transform 0.3s ease';
            return { transform: `translateX(${state.translateX}px)`, transition: transition, };
        }
        return {};
    },
    async login() {
        this.authLoading = true; this.authError = '';
        const { email, password } = this.loginForm;
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) { this.authError = error.message; }
        this.authLoading = false;
    },
    async register() {
        this.authLoading = true; this.authError = '';
        const { nome, email, password } = this.registerForm;
        const { data, error } = await supabase.auth.signUp({ email, password });
        if (error) { this.authError = error.message; this.authLoading = false; return; }
        await supabase.from('profiles').upsert({ id: data.user.id, email, nome });
        this.authView = 'login';
        this.authLoading = false;
        this.showProfileNotification('Cadastro realizado! Fa√ßa login.');
    },
    async fetchProfile() {
        if (!this.supabaseUser) return;
        const { data, error } = await supabase.from('profiles').select('*').eq('id', this.supabaseUser.id).single();
        if (data) {
            this.userProfile = {
                fotoUrl: data.foto_url || '', nome: data.nome || '', email: data.email || '', telefone: data.telefone || '', empresa: data.empresa || '', cnpj: data.cnpj || '', atuacao: data.atuacao || '', logradouro: data.logradouro || '', numero: data.numero || '', bairro: data.bairro || '', cidade: data.cidade || '', uf: data.uf || '', cep: data.cep || ''
            };
        } else {
            await supabase.from('profiles').upsert({ id: this.supabaseUser.id, email: this.supabaseUser.email, nome: '', foto_url: '', telefone: '', empresa: '', cnpj: '', atuacao: '', endereco: '', cep: '' });
            await this.fetchProfile();
        }
    },
    async saveProfile() {
        if (!this.supabaseUser) return;
        await supabase.from('profiles').upsert({ id: this.supabaseUser.id, foto_url: this.userProfile.fotoUrl, nome: this.userProfile.nome, email: this.userProfile.email, telefone: this.userProfile.telefone, empresa: this.userProfile.empresa, cnpj: this.userProfile.cnpj, atuacao: this.userProfile.atuacao, cep: this.userProfile.cep, logradouro: this.userProfile.logradouro, numero: this.userProfile.numero, bairro: this.userProfile.bairro, cidade: this.userProfile.cidade, uf: this.userProfile.uf });
        this.showProfileNotification('Perfil salvo com sucesso!');
        this.profileSubView = 'main';
    },
    async logout() {
        await supabase.auth.signOut();
        localStorage.removeItem('cajuia-user-profile');
        localStorage.removeItem('cajuia-cart');
        localStorage.removeItem('cajuia-wishlist');
        window.location.reload();
    },
    showProfileNotification(message, type = 'success', duration = 3000) {
        this.profileNotification.message = message;
        this.profileNotification.type = type;
        this.profileNotification.show = true;
        setTimeout(() => { this.profileNotification.show = false; }, duration);
    },
    triggerFileUpload() { this.$refs.fileInput.click(); },
    handlePictureUpload(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => { this.userProfile.fotoUrl = e.target.result; };
        reader.readAsDataURL(file);
    },
    showWipAlert() { alert('Funcionalidade em desenvolvimento.'); },
    clearSearchFilters() { this.searchQuery = ''; this.searchFilters.category = null; this.searchFilters.minPrice = null; this.searchFilters.maxPrice = null; },
    updatePriceFilter() { if (this.searchFilters.minPrice !== null && this.searchFilters.maxPrice !== null && this.searchFilters.minPrice > this.searchFilters.maxPrice) { this.searchFilters.maxPrice = this.searchFilters.minPrice; } if (this.searchFilters.maxPrice !== null && this.searchFilters.minPrice !== null && this.searchFilters.maxPrice < this.searchFilters.minPrice) { this.searchFilters.minPrice = this.searchFilters.maxPrice; } },
}
    }).mount('#app');
</script>
</body>
</html>
